import{u as C,j as e,c as B}from"./index-v6p7knVB.js";import{r as i,c as I}from"./react-vendor-CrzWfPmj.js";import{e as K,U as _,r as q,s as S,f as M,X as O,h as z,P as E,p as H,R as Q}from"./ui-vendor-DzlZg9lb.js";import{a as k,c as W}from"./api-C9ytrIjn.js";const P={X:"bg-blue-50 text-blue-700",XI:"bg-purple-50 text-purple-700",XII:"bg-green-50 text-green-700",default:"bg-indigo-50 text-indigo-700"};function J({classItem:a,onClick:u}){var b;const{t}=C(),r=((b=a.gradeLevel.split("-")[0])==null?void 0:b.trim().toUpperCase())||"",h=P[r]||P.default,n=()=>r==="X"?e.jsx(q,{className:"h-6 w-6 text-blue-600"}):r==="XI"?e.jsx(S,{className:"h-6 w-6 text-purple-600"}):r==="XII"?e.jsx(M,{className:"h-6 w-6 text-green-600"}):e.jsx(S,{className:"h-6 w-6 text-indigo-600"});return e.jsx("div",{className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer border border-gray-200 hover:border-brand-300",onClick:()=>u(a),children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-indigo-100 rounded-full p-3",children:n()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t("classes.gradeLevel"),": ",a.gradeLevel]})]}),e.jsx("div",{className:B("px-2.5 py-0.5 rounded-full text-xs font-medium flex items-center",h),children:r||a.gradeLevel})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:t("classes.academicYear")}),e.jsx("p",{className:"font-medium text-gray-900 truncate",children:a.academicYear})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:t("classes.students")}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"h-4 w-4 mr-1 text-indigo-600"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.studentCount})]})]}),a.teacherName&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-gray-500",children:t("classes.teacher")}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-4 w-4 mr-1 text-indigo-600"}),e.jsx("p",{className:"font-medium text-gray-900 truncate",children:a.teacherName})]})]})]})]})})}function V({onClose:a,onSubmit:u}){const{t}=C(),[r,h]=i.useState({name:"",gradeLevel:"",academicYear:new Date().getFullYear().toString(),studentCount:0,teacherName:""}),[n,b]=i.useState({}),p=d=>{const{name:f,value:j}=d.target;h(N=>({...N,[f]:f==="studentCount"?parseInt(j)||0:j})),n[f]&&b(N=>{const o={...N};return delete o[f],o})},v=()=>{const d={};return r.name.trim()||(d.name=t("validation.required")),r.gradeLevel.trim()||(d.gradeLevel=t("validation.required")),r.academicYear.trim()||(d.academicYear=t("validation.required")),b(d),Object.keys(d).length===0},x=d=>{d.preventDefault(),v()&&u(r)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:t("classes.addNew")}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:e.jsx(O,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:x,className:"p-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t("classes.name"),"*"]}),e.jsx("input",{type:"text",name:"name",value:r.name,onChange:p,className:`w-full px-3 py-2 border ${n.name?"border-red-500":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500`}),n.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t("classes.gradeLevel"),"*"]}),e.jsx("input",{type:"text",name:"gradeLevel",value:r.gradeLevel,onChange:p,className:`w-full px-3 py-2 border ${n.gradeLevel?"border-red-500":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500`}),n.gradeLevel&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.gradeLevel})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t("classes.academicYear"),"*"]}),e.jsx("input",{type:"text",name:"academicYear",value:r.academicYear,onChange:p,className:`w-full px-3 py-2 border ${n.academicYear?"border-red-500":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500`}),n.academicYear&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.academicYear})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t("classes.teacherName")}),e.jsx("input",{type:"text",name:"teacherName",value:r.teacherName,onChange:p,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:t("actions.cancel")}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500",children:t("actions.save")})]})]})]})})}const R="http://localhost:3001/api";async function Z(a={},u=1,t={}){const r={...a,page:u},h=await k.get(`${R}/classes`,{params:r,...t,timeout:1e4});return{data:h.data.classes,totalPages:h.data.totalPages}}async function ee(a,u={}){return(await k.post(`${R}/classes`,a,{...u,timeout:1e4})).data}function le(){const[a,u]=i.useState(""),[t,r]=i.useState(!1),[h,n]=i.useState([]),[b,p]=i.useState(!0),[v,x]=i.useState(null),[d,f]=i.useState(1),[j,N]=i.useState(1),[o,Y]=i.useState("all"),[A,X]=i.useState(0),F=3,{t:l}=C(),T=I(),w=i.useCallback(async()=>{var g,y;const{clearTimeout:s}=W(15e3);try{p(!0),x(null);const m={};a&&(m.searchQuery=a),o!=="all"&&(m.grade=o);const c=await Z(m,d);s(),c&&c.data?(n(c.data),N(c.totalPages||1)):(console.error("Invalid response format:",c),x(l("errors.invalidData")||"Data tidak valid"),n([]))}catch(m){if(console.error("Error loading classes:",m),k.isAxiosError(m)){const c=m;c.code==="ERR_CANCELED"?x(l("errors.timeout")||"Permintaan timeout"):x(((y=(g=c.response)==null?void 0:g.data)==null?void 0:y.detail)||l("errors.loadingClasses")||"Gagal memuat data kelas")}else x(l("errors.loadingClasses")||"Gagal memuat data kelas");n([])}finally{p(!1)}},[d,l,a,o]);i.useEffect(()=>{w()},[w]);const D=async s=>{var g,y;try{x(null);const m=await ee(s);n(c=>[...c,m]),r(!1)}catch(m){const c=m;console.error("Error creating class:",c),x(((y=(g=c.response)==null?void 0:g.data)==null?void 0:y.detail)||l("errors.creatingClass")||"Gagal membuat data kelas")}},$=s=>{T(`/classes/${s.id}/students`)},G=()=>{A<F?(X(s=>s+1),w()):x(l("errors.maxRetriesReached")||"Batas percobaan telah tercapai")},U=s=>{Y(o===s?"all":s)},L=h.filter(s=>{const g=s.name.toLowerCase().includes(a.toLowerCase()),y=o==="all"||s.gradeLevel.startsWith(o);return g&&y});return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:l("classes.title")||"Kelas"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:l("classes.subtitle")||"Kelola dan pantau kelas dan siswa"})]}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:l("classes.search")||"Cari kelas...",value:a,onChange:s=>u(s.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex gap-2",children:["X","XI","XII"].map(s=>e.jsx("button",{onClick:()=>U(s),className:`px-3 py-1 rounded-lg text-sm font-medium ${o===s?"bg-brand-100 text-brand-700 border-brand-200":"bg-white text-gray-700 border-gray-300"} border hover:bg-gray-50`,children:s},s))}),e.jsxs("button",{onClick:()=>r(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-brand-600 hover:bg-brand-700",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),l("classes.add")||"Tambah Kelas"]})]})]}),v&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("p",{className:"text-red-700",children:v})]}),e.jsxs("button",{onClick:G,className:"inline-flex items-center px-3 py-1 border border-red-300 rounded-md text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),l("actions.retry")||"Coba lagi"]})]})}),b?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((s,g)=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"animate-pulse flex space-x-4",children:[e.jsx("div",{className:"rounded-full bg-gray-200 h-16 w-16"}),e.jsxs("div",{className:"flex-1 space-y-4 py-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]})]})},g))}):e.jsxs(e.Fragment,{children:[L.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:a||o!=="all"?l("classes.noResults")||"Tidak ada hasil yang cocok":l("classes.noClasses")||"Belum ada data kelas"}),!a&&o==="all"&&e.jsxs("button",{onClick:()=>r(!0),className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-brand-600 hover:bg-brand-700",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),l("classes.add")||"Tambah Kelas"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:L.map(s=>e.jsx(J,{classItem:s,onClick:$},s.id))}),j>1&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("nav",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>f(s=>Math.max(1,s-1)),disabled:d===1,className:"px-3 py-1 rounded-md text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:l("pagination.previous")||"Sebelumnya"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[l("pagination.page")||"Halaman"," ",d," ",l("pagination.of")||"dari"," ",j]}),e.jsx("button",{onClick:()=>f(s=>Math.min(j,s+1)),disabled:d===j,className:"px-3 py-1 rounded-md text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:l("pagination.next")||"Berikutnya"})]})})]}),t&&e.jsx(V,{onClose:()=>r(!1),onSubmit:D})]})}export{le as default};
