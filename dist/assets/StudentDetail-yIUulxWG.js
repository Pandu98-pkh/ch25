import{j as e,c as m,u as N}from"./index-v6p7knVB.js";import{r as o,e as S,c as D}from"./react-vendor-CrzWfPmj.js";import{a as I}from"./studentService-D9DYk2TT.js";import{b as C}from"./api-C9ytrIjn.js";import T from"./SessionsPage-y7MA72tg.js";import E from"./MentalHealthPage-Cyci6FWO.js";import R from"./BehaviorPage-qB_1q586.js";import _ from"./CareerPage-DqIxj85i.js";import{t as $,D as L}from"./ui-vendor-DzlZg9lb.js";import"./jspdf.plugin.autotable-DxlxnvA9.js";import"./toast-M3i0mrg7.js";const v=s=>{const a=new Date().toISOString().split("T")[0],t={studentId:s,reportDate:a,summary:{totalSessions:5,mentalHealthScore:78,behaviorRecords:8,status:"good"},sessions:[{id:"1",date:"2025-03-15",type:"academic",notes:"Diskusi tentang kemajuan akademik dan strategi belajar",outcome:"positive"},{id:"2",date:"2025-02-20",type:"behavioral",notes:"Membahas interaksi sosial di kelas",outcome:"neutral"}],assessments:[{id:"1",date:"2025-03-20",score:82,category:"routine",notes:"Perkembangan positif dalam manajemen stres"},{id:"2",date:"2025-02-10",score:75,category:"academic",notes:"Menunjukkan kecemasan terkait ujian"}],behavior:[{id:"1",date:"2025-03-25",type:"positive",description:"Membantu teman sekelas dalam proyek kelompok",severity:"mild"},{id:"2",date:"2025-02-15",type:"negative",description:"Terlambat mengumpulkan tugas",severity:"minor"}]};return new Blob([JSON.stringify(t,null,2)],{type:"application/json"})};let f=!0;const P=async s=>{try{if(f){console.log("Using mock report data");const a=v(s.studentId);return x(a,`student_report_${s.studentId}_${new Date().toISOString().slice(0,10)}.json`),a}try{const a=await C.get(`/students/${s.studentId}/report/`,{params:s,responseType:"blob"}),t=new Blob([a.data],{type:a.headers["content-type"]||"application/json"}),n=`student_report_${s.studentId}_${new Date().toISOString().slice(0,10)}.json`;return x(t,n),t}catch(a){throw console.error("API error generating report:",a),a}}catch(a){console.error("Error generating report:",a),f=!0;const t=v(s.studentId),n=`student_report_${s.studentId}_${new Date().toISOString().slice(0,10)}.json`;return x(t,n),t}},x=(s,a)=>{try{const t=window.URL.createObjectURL(s),n=document.createElement("a");n.href=t,n.download=a,document.body.appendChild(n),n.click(),setTimeout(()=>{n.remove(),window.URL.revokeObjectURL(t)},100)}catch(t){throw console.error("Error triggering download:",t),new Error("Gagal mengunduh file")}},y=o.createContext(void 0);function k(){const s=o.useContext(y);if(!s)throw new Error("Tabs components must be used within a Tabs provider");return s}function O({defaultValue:s,children:a,className:t}){const[n,d]=o.useState(s);return e.jsx(y.Provider,{value:{value:n,onValueChange:d},children:e.jsx("div",{className:m("w-full",t),"data-tab-value":n,children:a})})}function M({children:s,className:a}){return e.jsx("div",{className:m("flex space-x-1",a),children:s})}function c({value:s,children:a,className:t}){const{value:n,onValueChange:d}=k(),l=n===s;return e.jsx("button",{className:m("px-3 py-2 text-sm font-medium rounded-md","data-[state=active]:bg-brand-100 data-[state=active]:text-brand-900","hover:bg-gray-100",t),"data-state":l?"active":"inactive","data-value":s,onClick:()=>d(s),children:a})}function u({value:s,children:a,className:t}){const{value:n}=k();return n===s?e.jsx("div",{className:m("mt-2",t),"data-value":s,children:a}):null}function Q(){const{id:s}=S(),a=D(),[t,n]=o.useState(null),[d,l]=o.useState(!0),[g,h]=o.useState(null),[p,b]=o.useState(!1),{t:r}=N(),j=o.useCallback(async()=>{try{l(!0),h(null);const i=await I(s);n(i)}catch(i){console.error("Error loading student:",i),h(r("errors.loadingStudent"))}finally{l(!1)}},[s,r]);o.useEffect(()=>{s&&j()},[s,j]);const w=async()=>{if(t!=null&&t.id)try{b(!0);const i={studentId:t.id,includeAssessments:!0,includeBehavior:!0,includeSessions:!0};await P(i)}catch(i){console.error("Error generating report:",i)}finally{b(!1)}};return d?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"h-24 bg-gray-200 rounded mb-6"}),e.jsx("div",{className:"h-96 bg-gray-200 rounded"})]}):g||!t?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-600 mb-4",children:g||r("errors.studentNotFound")}),e.jsx("button",{onClick:()=>a("/students"),className:"text-brand-600 hover:text-brand-700 font-medium",children:r("actions.backToStudents")})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>a("/students"),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx($,{className:"h-5 w-5 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r("students.tingkat")," ",t.tingkat," â€¢ ",r("students.kelas")," ",t.kelas]})]})]}),e.jsxs("button",{onClick:w,disabled:p,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),r(p?"actions.generating":"actions.generateReport")]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:r("studentDetail.academicStatus")}),e.jsx("p",{className:`mt-1 font-medium ${t.academicStatus==="good"?"text-green-600":t.academicStatus==="warning"?"text-yellow-600":"text-red-600"}`,children:r(`status.${t.academicStatus}`)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:r("studentDetail.email")}),e.jsx("p",{className:"mt-1 font-medium text-gray-900 truncate",children:t.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:r("studentDetail.tingkat")}),e.jsx("p",{className:"mt-1 font-medium text-gray-900",children:t.tingkat})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:r("studentDetail.kelas")}),e.jsx("p",{className:"mt-1 font-medium text-gray-900",children:t.kelas})]})]})}),e.jsxs(O,{defaultValue:"sessions",className:"space-y-4",children:[e.jsxs(M,{className:"bg-white shadow rounded-lg p-1",children:[e.jsx(c,{value:"sessions",children:r("nav.sessions")}),e.jsx(c,{value:"mental-health",children:r("nav.mentalHealth")}),e.jsx(c,{value:"behavior",children:r("nav.behavior")}),e.jsx(c,{value:"career",children:r("nav.career")})]}),e.jsx(u,{value:"sessions",children:e.jsx(T,{studentId:t.id})}),e.jsx(u,{value:"mental-health",children:e.jsx(E,{studentId:t.id})}),e.jsx(u,{value:"behavior",children:e.jsx(R,{studentId:t.id})}),e.jsx(u,{value:"career",children:e.jsx(_,{studentId:t.id})})]})]})}export{Q as default};
