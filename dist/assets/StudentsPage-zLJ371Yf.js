import{u as V,j as e,c as F,g as de,a as oe,b as ce,d as me,e as ge,f as xe,h as ue}from"./index-CdZ0Um37.js";import{r as c,u as he}from"./react-vendor-BzbKlFBU.js";import{A as X,r as Z,E as le,J as be,T as ie,t as ee,n as fe,y as pe,K as z,N as je,O as ve,q as ye,p as we,X as Ne,Q as ne,f as ae,R as ke,U as Se,V as Ie,W as se,Y as Ce}from"./ui-vendor-CCWSLpt1.js";import{S as Ee,g as De}from"./StudentTable-CuVMGOKx.js";import{g as Te}from"./classService-z35wyvSM.js";import{I as Ue}from"./ImageUploader-B7rcQsGQ.js";import Ae from"./DeletedStudentsManagement-C2Km9ku-.js";const te={good:{color:"text-green-700",bgColor:"bg-green-50",borderColor:"border-green-200",icon:le},warning:{color:"text-yellow-700",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",icon:Z},critical:{color:"text-red-700",bgColor:"bg-red-50",borderColor:"border-red-200",icon:X}};function Me({student:a,onClick:R,onEdit:U,onDelete:m}){const T=a.academicStatus||"warning",{t:s}=V(),[i,k]=c.useState(!1),u=a.avatar||a.photo||"/assets/images/default-avatar.png",h=te[T]||te.warning,b=p=>{p.stopPropagation(),U==null||U(a)},I=p=>{p.stopPropagation(),m==null||m(a)};return e.jsxs("div",{onClick:()=>R(a),className:`bg-white rounded-xl shadow-sm hover:shadow-md transition-all duration-300 \r
                cursor-pointer overflow-hidden group border border-gray-200 relative transform hover:-translate-y-1`,children:[e.jsx("div",{className:F("h-1.5 w-full absolute top-0 left-0",h.bgColor)}),(U||m)&&e.jsxs("div",{className:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex space-x-1 z-10",children:[U&&e.jsx("button",{onClick:b,className:"p-1.5 rounded-full bg-white shadow-md border border-gray-200 text-gray-600 hover:text-indigo-600 hover:border-indigo-300 transition-colors",title:s("actions.edit")||"Edit",children:e.jsx(be,{className:"h-4 w-4"})}),m&&e.jsx("button",{onClick:I,className:"p-1.5 rounded-full bg-white shadow-md border border-gray-200 text-gray-600 hover:text-red-600 hover:border-red-300 transition-colors",title:s("actions.delete")||"Delete",children:e.jsx(ie,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-5 pt-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[i?e.jsx("div",{className:"h-16 w-16 rounded-full bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center ring-2 ring-gray-100 group-hover:ring-indigo-200 transition-all",children:e.jsx(ee,{className:"h-8 w-8 text-indigo-400"})}):e.jsx("img",{src:u,alt:a.name,className:"h-16 w-16 rounded-full object-cover ring-2 ring-gray-100 group-hover:ring-indigo-200 transition-all duration-300",onError:()=>k(!0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 group-hover:text-indigo-700 transition-colors duration-200 truncate",children:a.name}),e.jsxs("div",{className:F("px-2.5 py-1 rounded-full text-xs font-medium flex items-center",h.bgColor,h.color,`border ${h.borderColor}`),children:[e.jsx(h.icon,{className:"w-3.5 h-3.5 mr-1"}),s(`status.${T}`)]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1 flex items-center",children:[e.jsx(fe,{className:"h-3.5 w-3.5 mr-1.5 text-indigo-400"}),s("students.tingkat")," ",a.tingkat||a.grade," • ",s("students.kelas")," ",a.kelas||a.class]})]})]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 border border-gray-100 transition-all duration-200 group-hover:border-indigo-100",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(pe,{className:"h-3.5 w-3.5 mr-1.5 text-indigo-400"}),s("studentDetail.academicStatus")]}),e.jsx("p",{className:F("font-semibold text-sm",h.color),children:s(`status.${T}`)})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-gray-50 border border-gray-100 transition-all duration-200 group-hover:border-indigo-100",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(ee,{className:"h-3.5 w-3.5 mr-1.5 text-indigo-400"}),s("studentDetail.email")]}),e.jsx("p",{className:"font-medium text-sm text-gray-700 truncate",children:a.email||"No email"})]})]}),(a.mentalHealthScore!==void 0||a.lastCounseling)&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3",children:[a.mentalHealthScore!==void 0&&e.jsxs("div",{className:"p-3 rounded-lg bg-indigo-50 border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-indigo-600 font-medium",children:s("studentDetail.mentalHealthScore")}),e.jsxs("span",{className:"text-sm font-bold text-indigo-700",children:[a.mentalHealthScore,"/100"]})]}),e.jsx("div",{className:"mt-2 h-1.5 w-full bg-indigo-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-indigo-600 rounded-full",style:{width:`${a.mentalHealthScore}%`}})})]}),a.lastCounseling&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center",children:[e.jsx(Z,{className:"h-3.5 w-3.5 mr-1.5 text-indigo-400"}),s("studentDetail.lastCounseling"),": ",e.jsx("span",{className:"ml-1 font-medium text-gray-700",children:a.lastCounseling})]})]})]})]})}function Re({students:a,onStudentClick:R,onStudentEdit:U,onStudentDelete:m,onBulkAction:T,defaultView:s="table"}){const{t:i}=V(),[k,L]=c.useState(s),[u,h]=c.useState("10"),[b,I]=c.useState(1),[p,G]=c.useState(new Set),A=u==="semua"?a.length:parseInt(u),S=u==="semua"?1:Math.ceil(a.length/A),w=u==="semua"?0:(b-1)*A,M=u==="semua"?a.length:w+A,C=a.slice(w,M),$=k==="card"?C.slice(0,100):C,H=k==="card"&&C.length>100,E=D=>{h(D),I(1)},K=async()=>{const D=C.filter((f,N)=>{const o=f.id||f.email||`${f.name}-${f.tingkat||f.grade}-${f.kelas||f.class}`||`student-${N}`;return p.has(o)});try{const f=D.map(o=>o.id||o.studentId),N=await fetch("/api/students/bulk-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentIds:f})});if(N.ok){const o=await N.json();T&&T(D,"delete"),console.log(o.message)}else{const o=await N.json();console.error("Bulk delete failed:",o.message)}}catch(f){console.error("Network error during bulk delete:",f)}G(new Set)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 flex-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:u,onChange:D=>E(D.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white",children:[e.jsx("option",{value:"10",children:i("limit.ten")||"Tampilkan 10"}),e.jsx("option",{value:"100",children:i("limit.hundred")||"Tampilkan 100"}),e.jsx("option",{value:"500",children:i("limit.fiveHundred")||"Tampilkan 500"}),e.jsx("option",{value:"semua",children:i("limit.all")||"Tampilkan Semua"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[e.jsx("span",{className:"font-medium",children:C.length}),e.jsx("span",{className:"ml-1",children:C.length===1?i("students.singular")||"siswa":i("students.plural")||"siswa"}),a.length!==C.length&&e.jsxs("span",{className:"ml-1 text-gray-400",children:[i("search.from")||"dari"," ",a.length]}),S>1&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["• ",i("pagination.page")||"Halaman"," ",b," ",i("pagination.of")||"dari"," ",S]})]})]}),e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>L("table"),className:F("px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 flex items-center space-x-2",k==="table"?"bg-white shadow-sm text-gray-900":"text-gray-500 hover:text-gray-700"),children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{children:i("view.table")||"Tabel"})]}),e.jsxs("button",{onClick:()=>L("card"),className:F("px-3 py-2 rounded-md text-sm font-medium transition-all duration-200 flex items-center space-x-2",k==="card"?"bg-white shadow-sm text-gray-900":"text-gray-500 hover:text-gray-700"),children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{children:i("view.card")||"Kartu"})]})]})]}),k==="card"&&a.length>100&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(z,{className:"h-5 w-5 text-yellow-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:i("performance.warning")||"Peringatan Performa"}),e.jsx("div",{className:"mt-1 text-sm text-yellow-700",children:e.jsx("p",{children:i("performance.cardLimit")||"View kartu dibatasi 100 siswa untuk performa optimal. Gunakan view tabel untuk dataset besar atau gunakan filter untuk mempersempit hasil."})})]})]})}),"        ",H&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("div",{className:"text-sm text-blue-700",children:`Menampilkan 100 dari ${C.length} siswa. Gunakan filter atau beralih ke view tabel untuk melihat semua data.`})}),u!=="semua"&&a.length>parseInt(u)&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("div",{className:"text-sm text-blue-700",children:`Menampilkan ${Math.min(parseInt(u),a.length)} dari ${a.length} siswa yang sesuai filter. Gunakan pagination atau pilih "Tampilkan Semua" untuk melihat semua hasil.`})})]}),"      ",k==="table"?e.jsx(Ee,{students:C,onClick:R,onEdit:U,onDelete:m,onBulkAction:T}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[$.map(D=>e.jsx(Me,{student:D,onClick:R,onEdit:U,onDelete:m},De(D))),$.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(z,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:i("search.noResults")||"Tidak ada siswa ditemukan"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:i("search.noResultsDesc")||"Coba ubah filter atau kata kunci pencarian"})]})]}),S>1&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:[i("pagination.showing")||"Menampilkan"," ",w+1," - ",Math.min(M,a.length)," ",i("pagination.of")||"dari"," ",a.length," ",i("students.plural")||"siswa"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>I(Math.max(1,b-1)),disabled:b===1,className:F("px-3 py-2 rounded-md text-sm font-medium flex items-center space-x-1 border",b===1?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{children:i("pagination.previous")||"Sebelumnya"})]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,S)},(D,f)=>{let N;return S<=5||b<=3?N=f+1:b>=S-2?N=S-4+f:N=b-2+f,e.jsx("button",{onClick:()=>I(N),className:F("px-3 py-2 rounded-md text-sm font-medium border",b===N?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),children:N},N)})}),e.jsxs("button",{onClick:()=>I(Math.min(S,b+1)),disabled:b===S,className:F("px-3 py-2 rounded-md text-sm font-medium flex items-center space-x-1 border",b===S?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),children:[e.jsx("span",{children:i("pagination.next")||"Selanjutnya"}),e.jsx(we,{className:"h-4 w-4"})]})]})]})}),k==="card"&&p.size>0&&e.jsxs("div",{className:"flex items-center space-x-2 bg-blue-50 px-3 py-2 rounded-lg border border-blue-200",children:[e.jsxs("span",{className:"text-sm text-blue-700 font-medium",children:[p.size," ",i("selected")||"terpilih"]}),e.jsxs("button",{onClick:K,className:"px-3 py-1 text-sm bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center space-x-1",title:i("actions.deleteSelected")||"Hapus yang dipilih",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{children:i("actions.delete")||"Hapus"})]}),e.jsx("button",{onClick:()=>G(new Set),className:"px-2 py-1 text-sm text-blue-600 hover:text-blue-800",children:i("actions.clearSelection")||"Batal"})]})]})}function re({student:a,onClose:R,onSubmit:U}){const{t:m}=V(),T=!!a,[s,i]=c.useState({name:(a==null?void 0:a.name)||"",email:(a==null?void 0:a.email)||"",tingkat:(a==null?void 0:a.tingkat)||(a==null?void 0:a.grade)||"",kelas:(a==null?void 0:a.kelas)||(a==null?void 0:a.class)||"",avatar:(a==null?void 0:a.avatar)||(a==null?void 0:a.photo)||"",avatarType:"url",academicStatus:(a==null?void 0:a.academicStatus)||"good",studentId:(a==null?void 0:a.studentId)||(a==null?void 0:a.id)||"",classId:(a==null?void 0:a.classId)||""}),[k,L]=c.useState(!1),[u,h]=c.useState(null),[b,I]=c.useState(null),[p,G]=c.useState([]),[A,S]=c.useState(!0),[w,M]=c.useState(null),[C,$]=c.useState([]),[H,E]=c.useState([]),K=async(r=0)=>{try{S(!0),M(null);const d=await Te({},1,1e3);if(d&&d.data){G(d.data);const v=new Set;d.data.forEach(g=>{let x=g.gradeLevel;x==="10"?x="X":x==="11"?x="XI":x==="12"&&(x="XII");const l=x.split(" ")[0];v.add(l)});const t=Array.from(v).sort((g,x)=>{const l={X:1,XI:2,XII:3};return(l[g]||999)-(l[x]||999)});$(t),console.log("✅ Classes data loaded successfully:",d.data.length,"classes"),console.log("📊 Available tingkat:",t)}}catch(d){if(console.error("❌ Error fetching classes:",d),r<3){console.log(`🔄 Retrying... (${r+1}/3)`),setTimeout(()=>K(r+1),1e3*(r+1));return}M("Gagal memuat data kelas dari database"),console.log("🛡️ Using fallback data"),$(["X","XI","XII"]),E(["IPA-1","IPA-2","IPA-3","IPS-1","IPS-2"])}finally{S(!1)}},D=r=>{if(!r){E([]);return}const n=p.filter(d=>{let v=d.gradeLevel;return v==="10"?v="X":v==="11"?v="XI":v==="12"&&(v="XII"),v.split(" ")[0]===r}).map(d=>d.name).sort();E(n)},f=(r,n)=>{if(!r||!n)return"";const d=p.find(v=>{let t=v.gradeLevel;return t==="10"?t="X":t==="11"?t="XI":t==="12"&&(t="XII"),t.split(" ")[0]===r&&v.name===n});return(d==null?void 0:d.classId)||""};c.useEffect(()=>{K()},[]),c.useEffect(()=>{if(D(s.tingkat),s.kelas&&s.tingkat){if(!p.some(n=>{let d=n.gradeLevel;return d==="10"?d="X":d==="11"?d="XI":d==="12"&&(d="XII"),d.split(" ")[0]===s.tingkat&&n.name===s.kelas}))i(n=>({...n,kelas:"",classId:""}));else if(s.kelas&&!s.classId){const n=f(s.tingkat,s.kelas);n&&i(d=>({...d,classId:n}))}}},[s.tingkat,p,s.kelas,s.classId]);const N=async r=>{if(!r.trim()){h(null),I(null);return}L(!0),I(null),h(null);try{const n=await de(r);if(n){if(n.role!=="student"){I(`User ditemukan tetapi bukan student (Role: ${n.role})`),h(!1);return}i(d=>({...d,name:n.name||"",email:n.email||"",avatar:n.photo||"",tingkat:n.tingkat||d.tingkat,kelas:n.kelas||d.kelas})),h(!0),I(null)}}catch(n){console.error("Error fetching user data:",n),I("User tidak ditemukan dalam sistem user management"),h(!1),i(d=>({...d,name:"",email:"",avatar:""}))}finally{L(!1)}};c.useEffect(()=>{if(T)return;const r=setTimeout(()=>{s.studentId&&N(s.studentId)},500);return()=>clearTimeout(r)},[s.studentId,T]);const o=r=>{const n=r.target.value;i({...s,studentId:n}),n!==s.studentId&&(h(null),I(null))},[W,B]=c.useState(!1),[Y,J]=c.useState(""),q=async r=>{var v,t,g,x;if(r.preventDefault(),!s.studentId.trim()){alert("Nomor Induk Siswa (NIS) wajib diisi. Masukkan User ID dari sistem user management.");return}let n=s.classId;if(!n&&s.tingkat&&s.kelas){if(n=f(s.tingkat,s.kelas),console.log("🔍 DEBUG: getClassId result:",n),console.log("🔍 DEBUG: tingkat:",s.tingkat,"kelas:",s.kelas),console.log("🔍 DEBUG: available classes:",p.map(l=>({id:l.classId,name:l.name,grade:l.gradeLevel}))),!n){console.error("❌ No matching class_id found for the selected tingkat and kelas"),alert("Tidak dapat menemukan class ID untuk tingkat dan kelas yang dipilih. Silakan pilih ulang.");return}i(l=>({...l,classId:n}))}const d={studentId:s.studentId,name:s.name,email:s.email,tingkat:s.tingkat,kelas:s.kelas,classId:n,academicStatus:s.academicStatus,avatar:s.avatar||"",grade:s.tingkat,class:s.kelas,photo:s.avatar||"",avatar_type:s.avatarType||"url",avatar_filename:s.avatarFilename};console.log("🚀 DEBUG: Submitting student data:",d);try{await U(d),R()}catch(l){if(console.error("❌ DEBUG: Error submitting student:",l),(t=(v=l==null?void 0:l.response)==null?void 0:v.data)!=null&&t.showModal||((x=(g=l==null?void 0:l.response)==null?void 0:g.data)==null?void 0:x.error)==="USER_ALREADY_EXISTS")J(l.response.data.message||"User dengan email ini sudah terdaftar sebagai siswa"),B(!0);else throw l}},Q=r=>{i({...s,avatar:r.url,avatarType:r.type,avatarFilename:r.filename})};return e.jsxs("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 z-50 flex items-center justify-center p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 bg-white",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:T?m("editStudent.title","Edit Student"):m("addStudent.title","Add Student")}),e.jsx("button",{onClick:R,className:"text-gray-400 hover:text-gray-500",children:e.jsx(Ne,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"overflow-y-auto flex-1 scrollbar-light",children:e.jsxs("form",{onSubmit:q,className:"p-6",children:[e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ne,{className:"h-5 w-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Auto-fill dari User Management"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Masukkan Nomor Induk Siswa (NIS) untuk mencari dan mengisi data otomatis dari sistem user management. Data seperti nama dan email akan terisi secara otomatis jika user ditemukan."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:"Informasi Dasar"}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"studentId",className:"block text-sm font-medium text-gray-700",children:[m("addStudent.studentId","Nomor Induk Siswa (NIS)"),e.jsx("span",{className:"text-xs text-gray-500 font-normal block mt-1",children:"Gunakan User ID dari sistem user management"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"studentId",required:!0,value:s.studentId,onChange:o,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 pr-10",placeholder:"Masukkan User ID (contoh: U123456)"}),e.jsxs("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:[k&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-brand-600"}),!k&&u===!0&&e.jsx(ae,{className:"h-4 w-4 text-green-500"}),!k&&u===!1&&e.jsx(X,{className:"h-4 w-4 text-red-500"})]})]}),b&&e.jsxs("p",{className:"mt-1 text-sm text-red-600 flex items-center",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),b]}),u===!0&&e.jsxs("p",{className:"mt-1 text-sm text-green-600 flex items-center",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Data user berhasil ditemukan dan diisi otomatis"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:[m("addStudent.fullName"),u===!0&&e.jsx("span",{className:"ml-2 text-xs text-green-600 font-normal",children:"(Diisi otomatis dari user management)"})]}),e.jsx("input",{type:"text",id:"name",required:!0,value:s.name,onChange:r=>i({...s,name:r.target.value}),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 ${u===!0?"bg-green-50 border-green-300":""}`})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:[m("addStudent.email"),u===!0&&e.jsx("span",{className:"ml-2 text-xs text-green-600 font-normal",children:"(Diisi otomatis dari user management)"})]}),e.jsx("input",{type:"email",id:"email",required:!0,value:s.email,onChange:r=>i({...s,email:r.target.value}),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 ${u===!0?"bg-green-50 border-green-300":""}`})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:"Informasi Akademik"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"tingkat",className:"block text-sm font-medium text-gray-700",children:[m("students.tingkat"),A&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:[e.jsx(ke,{className:"inline h-3 w-3 animate-spin mr-1"}),"Loading..."]})]}),e.jsxs("select",{id:"tingkat",required:!0,value:s.tingkat,onChange:r=>i({...s,tingkat:r.target.value,kelas:"",classId:""}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500",disabled:A,children:[e.jsx("option",{value:"",children:m("addStudent.selectTingkat")}),C.map(r=>e.jsx("option",{value:r,children:r},r))]}),w&&e.jsxs("p",{className:"mt-1 text-xs text-amber-600 flex items-center",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Using fallback options (API unavailable)"]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"kelas",className:"block text-sm font-medium text-gray-700",children:[m("students.kelas"),!s.tingkat&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"(Pilih tingkat terlebih dahulu)"})]}),e.jsxs("select",{id:"kelas",required:!0,value:s.kelas,onChange:r=>{const n=r.target.value,d=f(s.tingkat,n);i({...s,kelas:n,classId:d})},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500",disabled:A||!s.tingkat,children:[e.jsx("option",{value:"",children:m("addStudent.selectKelas")}),H.map(r=>e.jsx("option",{value:r,children:r},r))]}),s.tingkat&&H.length===0&&!A&&e.jsxs("p",{className:"mt-1 text-xs text-amber-600 flex items-center",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Tidak ada kelas tersedia untuk tingkat ",s.tingkat]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:m("addStudent.academicStatus")}),e.jsxs("select",{id:"status",required:!0,value:s.academicStatus,onChange:r=>i({...s,academicStatus:r.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500",children:[e.jsx("option",{value:"good",children:m("status.good")}),e.jsx("option",{value:"warning",children:m("status.warning")}),e.jsx("option",{value:"critical",children:m("status.critical")})]})]}),e.jsx(Ue,{currentImage:s.avatar||"",onImageChange:Q,label:"Foto Siswa",className:"w-full"})]})]})]})}),e.jsx("div",{className:"border-t border-gray-200 px-6 py-4 bg-gray-50",children:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:R,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:m("addStudent.cancel")}),e.jsx("button",{type:"submit",onClick:q,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500",children:m("addStudent.submit")})]})})]}),W&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(X,{className:"w-6 h-6 text-yellow-600"})}),e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"User Sudah Ada"})})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:Y}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>B(!1),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"OK"})})]})})]})}function Ge(){const[a,R]=c.useState(""),[U,m]=c.useState(!1),[T,s]=c.useState(!1),[i,k]=c.useState(!1),[L,u]=c.useState(!1),[h,b]=c.useState(null),[I,p]=c.useState([]),[G,A]=c.useState(!0),[S,w]=c.useState(null),[M,C]=c.useState(1),[$,H]=c.useState(1),[E,K]=c.useState("all"),[D,f]=c.useState(0),N=3,{t:o}=V(),W=he(),B=c.useCallback(async()=>{var g,x;const{clearTimeout:t}=oe(15e3);try{A(!0),w(null);const l={};a&&(l.searchQuery=a),E!=="all"&&(l.academicStatus=E);const j=await ce(l,M,1e3);t(),j&&j.data?(p(j.data),H(j.totalPages||1)):(w(o("errors.invalidData")||"Data tidak valid"),p([]))}catch(l){if(me.isAxiosError(l)){const j=l;j.code==="ERR_CANCELED"?w(o("errors.timeout")||"Waktu permintaan habis"):w(((x=(g=j.response)==null?void 0:g.data)==null?void 0:x.detail)||(j.code==="ECONNABORTED"?o("errors.timeout")||"Waktu permintaan habis":o("errors.loadingStudents")||"Gagal memuat data siswa"))}else w(o("errors.loadingStudents")||"Gagal memuat data siswa");p([])}finally{A(!1)}},[M,o,a,E]);c.useEffect(()=>{B()},[B]);const Y=async t=>{var g,x,l,j,O,P;try{w(null);const y=await ge(t);p(_=>[..._,y]),m(!1)}catch(y){const _=y;if((x=(g=_.response)==null?void 0:g.data)!=null&&x.showModal||((j=(l=_.response)==null?void 0:l.data)==null?void 0:j.error)==="USER_ALREADY_EXISTS")throw y;w(((P=(O=_.response)==null?void 0:O.data)==null?void 0:P.detail)||o("errors.creatingStudent")||"Gagal membuat data siswa")}},J=async t=>{var g,x;try{if(w(null),!t.studentId&&!t.id)return;const l=t.studentId||t.id;if(!l)return;const j=await xe(l,t);p(O=>O.map(P=>P.studentId===l||P.id===l?j:P)),s(!1),b(null)}catch(l){w(((x=(g=l.response)==null?void 0:g.data)==null?void 0:x.detail)||o("errors.updatingStudent")||"Gagal mengupdate data siswa")}},q=async t=>{var g,x;try{w(null),await ue(t),p(l=>l.filter(j=>j.studentId!==t&&j.id!==t)),k(!1),b(null)}catch(l){w(((x=(g=l.response)==null?void 0:g.data)==null?void 0:x.detail)||o("errors.deletingStudent")||"Gagal menghapus data siswa")}},Q=t=>{W(`/app/students/${t.studentId||t.id}`)},r=()=>{D<N?(f(t=>t+1),B()):w(o("errors.maxRetriesReached")||"Batas percobaan telah tercapai")},n=I.filter(t=>{const g=t.name.toLowerCase().includes(a.toLowerCase()),x=E==="all"||t.academicStatus===E;return g&&x}),d=t=>{K(g=>g===t?"all":t)},v=t=>{switch(t){case"good":return e.jsx(le,{className:"h-4 w-4 mr-1"});case"warning":return e.jsx(Z,{className:"h-4 w-4 mr-1"});case"critical":return e.jsx(X,{className:"h-4 w-4 mr-1"})}};return L?e.jsx(Ae,{onBack:()=>u(!1)}):e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-gradient-to-br from-indigo-600 to-purple-700 w-12 h-12 rounded-lg flex items-center justify-center shadow-lg mr-4",children:e.jsx(Se,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600",children:o("students.title")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:o("students.subtitle")})]})]})}),e.jsx("div",{className:"mb-6 bg-white p-4 rounded-xl shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ne,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:o("students.search"),value:a,onChange:t=>R(t.target.value),className:"pl-10 pr-4 py-2.5 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{className:"bg-gray-100 p-1 rounded-lg flex",children:["good","warning","critical"].map(t=>e.jsxs("button",{onClick:()=>d(t),className:F("px-3 py-1.5 rounded-md text-sm font-medium flex items-center transition-all duration-200",E===t?t==="good"?"bg-green-600 text-white shadow-sm transform scale-105":t==="warning"?"bg-yellow-600 text-white shadow-sm transform scale-105":"bg-red-600 text-white shadow-sm transform scale-105":"bg-transparent text-gray-700 hover:bg-gray-200"),children:[v(t),o(`status.${t}`)]},t))})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 shadow-sm transition-all duration-200 hover:text-orange-600 hover:border-orange-500",children:[e.jsx(Ie,{className:"h-5 w-5 mr-2"}),"Siswa Dihapus"]}),e.jsxs("button",{onClick:()=>m(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 shadow-sm transition-all duration-200 transform hover:scale-105",children:[e.jsx(se,{className:"h-5 w-5 mr-2"}),o("students.add")]})]})]})]})}),S&&e.jsxs("div",{className:"mb-6 bg-red-50 rounded-xl shadow-sm border border-red-200 overflow-hidden",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-5 w-5 text-red-500 mr-3"}),e.jsx("p",{className:"text-red-700 font-medium",children:S})]}),e.jsxs("button",{onClick:r,className:"inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-medium text-white bg-red-600 hover:bg-red-700 transition-colors duration-200",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2 animate-spin-slow"}),o("actions.retry")||"Coba lagi"]})]})}),e.jsx("div",{className:"h-1 w-full bg-gradient-to-r from-red-500 to-red-300"})]}),G?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((t,g)=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-5 overflow-hidden",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-1.5 bg-indigo-200 w-full absolute top-0 left-0"}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"rounded-full bg-gray-200 h-16 w-16"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"h-16 bg-gray-200 rounded"}),e.jsx("div",{className:"h-16 bg-gray-200 rounded"})]}),e.jsx("div",{className:"mt-3 h-8 bg-gray-200 rounded"})]})},g))}):e.jsxs(e.Fragment,{children:[n.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"bg-gray-100 w-16 h-16 rounded-full mx-auto flex items-center justify-center mb-4",children:e.jsx(z,{className:"h-8 w-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-600 font-medium",children:a||E!=="all"?o("students.noResults")||"Tidak ada hasil yang cocok":o("students.noStudents")||"Belum ada data siswa"}),!a&&E==="all"&&e.jsxs("button",{onClick:()=>m(!0),className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 shadow-sm transition-all duration-200",children:[e.jsx(se,{className:"h-5 w-5 mr-2"}),o("students.add")||"Tambah Siswa"]})]}):e.jsx(Re,{students:n,defaultView:"table",onStudentClick:Q,onStudentEdit:t=>{b(t),s(!0)},onStudentDelete:t=>{b(t),k(!0)},onBulkAction:(t,g)=>{if(console.log("Bulk action:",g,"on",t.length,"students"),g==="delete")B();else if(g==="export"){const l=["Name,Email,Class,Status,Mental Health Score",...t.map(y=>({name:y.name,email:y.email,class:`${y.tingkat||y.grade} ${y.kelas||y.class}`,status:y.academicStatus,mentalHealthScore:y.mentalHealthScore})).map(y=>`"${y.name}","${y.email}","${y.class}","${y.status}","${y.mentalHealthScore||""}"`)].join(`
`),j=new Blob([l],{type:"text/csv"}),O=window.URL.createObjectURL(j),P=document.createElement("a");P.href=O,P.download=`students-export-${new Date().toISOString().split("T")[0]}.csv`,P.click(),window.URL.revokeObjectURL(O)}}}),$>1&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsxs("nav",{className:"inline-flex rounded-lg shadow-sm bg-white border border-gray-200 overflow-hidden divide-x divide-gray-200",children:[e.jsx("button",{onClick:()=>C(t=>Math.max(1,t-1)),disabled:M===1,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white transition-colors duration-200",children:o("pagination.previous")||"Sebelumnya"}),e.jsxs("div",{className:"px-4 py-2 bg-gray-50 text-sm font-medium text-gray-700",children:[M," / ",$]}),e.jsx("button",{onClick:()=>C(t=>Math.min($,t+1)),disabled:M===$,className:"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white transition-colors duration-200",children:o("pagination.next")||"Berikutnya"})]})})]}),U&&e.jsx(re,{onClose:()=>m(!1),onSubmit:Y}),T&&h&&e.jsx(re,{student:h,onClose:()=>s(!1),onSubmit:J}),i&&h&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 max-w-sm w-full",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:o("students.confirmDeleteTitle")}),e.jsx("p",{className:"text-gray-700 mb-6",children:o("students.confirmDeleteMessage")||`Apakah Anda yakin ingin menghapus siswa ${h.name}?`}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors duration-200",children:o("actions.cancel")||"Batal"}),e.jsx("button",{onClick:()=>{const t=h.studentId||h.id;t&&q(t)},className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors duration-200",children:o("actions.delete")||"Hapus"})]})]})})]})}export{Ge as default};
