import{u as S,j as e,c as G}from"./index-v6p7knVB.js";import{r as c,c as $}from"./react-vendor-CrzWfPmj.js";import{U as B,p as E,i as X,q as H,X as M,h as U,P as C,R as W}from"./ui-vendor-DzlZg9lb.js";import{g as _,c as z}from"./studentService-D9DYk2TT.js";import{c as O,a as J}from"./api-C9ytrIjn.js";const K={good:"bg-green-50 text-green-700",warning:"bg-yellow-50 text-yellow-700",critical:"bg-red-50 text-red-700"},Q={good:H,warning:X,critical:E};function V({student:s,onClick:p}){const r=s.academicStatus||"warning",l=Q[r],{t:n}=S(),[g,j]=c.useState(!1),f=s.avatar||s.photo||"/assets/avatars/default-avatar.png";return e.jsx("div",{onClick:()=>p(s),className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer border border-gray-200 hover:border-brand-300",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[g?e.jsx("div",{className:"h-16 w-16 rounded-full bg-gray-200 flex items-center justify-center border-2 border-gray-200",children:e.jsx(B,{className:"h-8 w-8 text-gray-500"})}):e.jsx("img",{src:f,alt:s.name,className:"h-16 w-16 rounded-full object-cover border-2 border-gray-200",onError:()=>{j(!0)}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[n("students.tingkat")," ",s.tingkat||s.grade," â€¢ ",n("students.kelas")," ",s.kelas||s.class]})]}),e.jsxs("div",{className:G("px-2.5 py-0.5 rounded-full text-xs font-medium flex items-center",K[r]),children:[e.jsx(l,{className:"w-4 h-4 mr-1"}),n(`status.${r}`)]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("studentDetail.email")}),e.jsx("p",{className:"font-medium text-gray-900 truncate",children:s.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("studentDetail.academicStatus")}),e.jsx("p",{className:`font-medium ${r==="good"?"text-green-600":r==="warning"?"text-yellow-600":"text-red-600"}`,children:n(`status.${r}`)})]}),s.mentalHealthScore!==void 0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("studentDetail.mentalHealthScore")}),e.jsx("p",{className:"font-medium text-gray-900",children:s.mentalHealthScore})]}),s.lastCounseling&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:n("studentDetail.lastCounseling")}),e.jsx("p",{className:"font-medium text-gray-900",children:s.lastCounseling})]})]})]})})}function Y({onClose:s,onSubmit:p}){const{t:r}=S(),[l,n]=c.useState({name:"",email:"",tingkat:"",kelas:"",avatar:"/assets/avatars/default-avatar.png",academicStatus:"good"}),g=c.useRef(null),j=a=>{a.preventDefault();const i={...l,grade:l.tingkat,class:l.kelas,photo:l.avatar||"/assets/avatars/default-avatar.png"};p(i),s()},y=a=>{var h;const i=(h=a.target.files)==null?void 0:h[0];if(!i)return;if(!i.type.startsWith("image/")){alert(r("addStudent.invalidImageType"));return}if(i.size>2*1024*1024){alert(r("addStudent.imageTooLarge"));return}const v=new FileReader;v.onload=N=>{var m;(m=N.target)!=null&&m.result&&n({...l,avatar:N.target.result})},v.readAsDataURL(i)},f=()=>{var a;(a=g.current)==null||a.click()};return e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:r("addStudent.title")}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-500",children:e.jsx(M,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:r("addStudent.fullName")}),e.jsx("input",{type:"text",id:"name",required:!0,value:l.name,onChange:a=>n({...l,name:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:r("addStudent.email")}),e.jsx("input",{type:"email",id:"email",required:!0,value:l.email,onChange:a=>n({...l,email:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tingkat",className:"block text-sm font-medium text-gray-700",children:r("students.tingkat")}),e.jsxs("select",{id:"tingkat",required:!0,value:l.tingkat,onChange:a=>n({...l,tingkat:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:r("addStudent.selectTingkat")}),["X","XI","XII"].map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"kelas",className:"block text-sm font-medium text-gray-700",children:r("students.kelas")}),e.jsxs("select",{id:"kelas",required:!0,value:l.kelas,onChange:a=>n({...l,kelas:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500",children:[e.jsx("option",{value:"",children:r("addStudent.selectKelas")}),["IPA-1","IPA-2","IPA-3","IPS-1","IPS-2"].map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:r("addStudent.academicStatus")}),e.jsxs("select",{id:"status",required:!0,value:l.academicStatus,onChange:a=>n({...l,academicStatus:a.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500",children:[e.jsx("option",{value:"good",children:r("status.good")}),e.jsx("option",{value:"warning",children:r("status.warning")}),e.jsx("option",{value:"critical",children:r("status.critical")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Foto Siswa"}),e.jsxs("div",{className:"mt-1 flex flex-col items-center",children:[e.jsx("div",{className:"mb-4 relative w-32 h-32",children:e.jsx("img",{src:l.avatar,alt:"Pratinjau foto siswa",className:"absolute inset-0 w-full h-full object-cover rounded-full border border-gray-300",onError:a=>{const i=a.target;i.src="/assets/avatars/default-avatar.png",i.onerror=null}})}),e.jsx("input",{type:"file",ref:g,accept:"image/*",onChange:y,className:"hidden"}),e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Pilih Foto"}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Format: JPG, PNG, atau GIF"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Ukuran maksimum: 2MB"})]})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:r("addStudent.cancel")}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500",children:r("addStudent.submit")})]})]})]})})}function re(){const[s,p]=c.useState(""),[r,l]=c.useState(!1),[n,g]=c.useState([]),[j,y]=c.useState(!0),[f,a]=c.useState(null),[i,v]=c.useState(1),[h,N]=c.useState(1),[m,F]=c.useState("all"),[P,A]=c.useState(0),I=3,{t:d}=S(),R=$(),w=c.useCallback(async()=>{var u,b;const{clearTimeout:t}=O(15e3);try{y(!0),a(null);const x={};s&&(x.searchQuery=s),m!=="all"&&(x.academicStatus=m);const o=await _(x,i);t(),o&&o.data?(g(o.data),N(o.totalPages||1)):(console.error("Invalid response format:",o),a(d("errors.invalidData")||"Data tidak valid"),g([]))}catch(x){if(console.error("Error loading students:",x),J.isAxiosError(x)){const o=x;o.code==="ERR_CANCELED"?a(d("errors.timeout")||"Waktu permintaan habis"):a(((b=(u=o.response)==null?void 0:u.data)==null?void 0:b.detail)||(o.code==="ECONNABORTED"?d("errors.timeout")||"Waktu permintaan habis":d("errors.loadingStudents")||"Gagal memuat data siswa"))}else a(d("errors.loadingStudents")||"Gagal memuat data siswa");g([])}finally{y(!1)}},[i,d,s,m]);c.useEffect(()=>{w()},[w]);const D=async t=>{var u,b;try{a(null);const x=await z(t);g(o=>[...o,x]),l(!1)}catch(x){const o=x;console.error("Error creating student:",o),a(((b=(u=o.response)==null?void 0:u.data)==null?void 0:b.detail)||d("errors.creatingStudent")||"Gagal membuat data siswa")}},T=t=>{R(`/students/${t.id}`)},L=()=>{P<I?(A(t=>t+1),w()):a(d("errors.maxRetriesReached")||"Batas percobaan telah tercapai")},k=n.filter(t=>{const u=t.name.toLowerCase().includes(s.toLowerCase()),b=m==="all"||t.academicStatus===m;return u&&b}),q=t=>{F(u=>u===t?"all":t)};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:d("students.title")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:d("students.subtitle")})]}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:d("students.search"),value:s,onChange:t=>p(t.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex gap-2",children:["good","warning","critical"].map(t=>e.jsx("button",{onClick:()=>q(t),className:`px-3 py-1 rounded-lg text-sm font-medium ${m===t?"bg-brand-100 text-brand-700 border-brand-200":"bg-white text-gray-700 border-gray-300"} border hover:bg-gray-50`,children:d(`status.${t}`)},t))}),e.jsxs("button",{onClick:()=>l(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-brand-600 hover:bg-brand-700",children:[e.jsx(C,{className:"h-5 w-5 mr-2"}),d("students.add")]})]})]}),f&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("p",{className:"text-red-700",children:f})]}),e.jsxs("button",{onClick:L,className:"inline-flex items-center px-3 py-1 border border-red-300 rounded-md text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100",children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),d("actions.retry")||"Coba lagi"]})]})}),j?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((t,u)=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"animate-pulse flex space-x-4",children:[e.jsx("div",{className:"rounded-full bg-gray-200 h-16 w-16"}),e.jsxs("div",{className:"flex-1 space-y-4 py-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]})]})},u))}):e.jsxs(e.Fragment,{children:[k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:s||m!=="all"?d("students.noResults")||"Tidak ada hasil yang cocok":d("students.noStudents")||"Belum ada data siswa"}),!s&&m==="all"&&e.jsxs("button",{onClick:()=>l(!0),className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-brand-600 hover:bg-brand-700",children:[e.jsx(C,{className:"h-5 w-5 mr-2"}),d("students.add")||"Tambah Siswa"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(t=>e.jsx(V,{student:t,onClick:T},t.id))}),h>1&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("nav",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>v(t=>Math.max(1,t-1)),disabled:i===1,className:"px-3 py-1 rounded-md text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:d("pagination.previous")||"Sebelumnya"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[d("pagination.page")||"Halaman"," ",i," ",d("pagination.of")||"dari"," ",h]}),e.jsx("button",{onClick:()=>v(t=>Math.min(h,t+1)),disabled:i===h,className:"px-3 py-1 rounded-md text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:d("pagination.next")||"Berikutnya"})]})})]}),r&&e.jsx(Y,{onClose:()=>l(!1),onSubmit:D})]})}export{re as default};
