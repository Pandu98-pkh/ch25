import{u as ee,j as e,c}from"./index-CPR8hM9m.js";import{r as i}from"./react-vendor-aXCYw_-y.js";import{b as q,c as se}from"./api-C9ytrIjn.js";import{g as re}from"./studentService-D9DYk2TT.js";import{t as C}from"./toast-M3i0mrg7.js";import{v as B,A as b,R as te,as as z,s as A,w as ae,P as L,U as oe,t as G,o as ie,q as ne,X as le,a8 as de}from"./ui-vendor-DZXJ8q2B.js";const f=[{id:"1",studentId:"1",date:"2024-04-02",type:"positive",description:"Membantu teman sekelas menyelesaikan tugas kelompok",severity:"positive",reporter:{id:"3",name:"Ms. Reynolds"},actionTaken:"Penghargaan verbal",category:"participation"},{id:"2",studentId:"2",date:"2024-04-03",type:"negative",description:"Tidak mengumpulkan tugas tepat waktu untuk ketiga kalinya",severity:"minor",reporter:{id:"4",name:"Mr. Wilson"},actionTaken:"Diskusi dengan siswa",category:"discipline"},{id:"3",studentId:"1",date:"2024-03-25",type:"negative",description:"Terlambat masuk kelas",severity:"minor",reporter:{id:"3",name:"Ms. Reynolds"},actionTaken:"Peringatan verbal",category:"attendance"}];let y=!0;const F=o=>{const r=new Set,n=[];for(const l of o)if(!r.has(l.id))r.add(l.id),n.push(l);else{const d=`${l.id}-${Date.now()}`;r.add(d),n.push({...l,id:d})}return n},ce=async(o,r,n=1)=>{try{if(y){console.log("Using mock behavior record data");let m=f.filter(p=>p.studentId===o);return{data:m,count:m.length,totalPages:1,currentPage:1}}const l=await q.get("/behavior/",{params:{student:o,page:n,...r}}),d=F(l.data.results||[]);return{data:d,count:d.length,totalPages:l.data.total_pages||1,currentPage:l.data.current_page||n}}catch(l){console.error("Error loading behavior records:",l),y=!0;const d=f.filter(p=>p.studentId===o),m=F(d);return{data:m,count:m.length,totalPages:1,currentPage:1}}},me=async o=>{try{if(y){const n={...o,id:String(f.length+1)};return f.push(n),n}return(await q.post("/behavior/",o)).data}catch(r){if(console.error("Error creating behavior record:",r),!y){y=!0;const n={...o,id:String(Date.now())};return f.push(n),n}throw r}},O={positive:{bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200",gradient:"from-green-500 to-teal-400",icon:z},neutral:{bgColor:"bg-gray-50",textColor:"text-gray-700",borderColor:"border-gray-200",gradient:"from-gray-400 to-gray-300",icon:G},minor:{bgColor:"bg-yellow-50",textColor:"text-yellow-700",borderColor:"border-yellow-200",gradient:"from-yellow-500 to-amber-400",icon:A},major:{bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200",gradient:"from-red-500 to-rose-400",icon:b}},_={attendance:{icon:A,bgColor:"bg-blue-50",textColor:"text-blue-700",borderColor:"border-blue-200"},discipline:{icon:b,bgColor:"bg-purple-50",textColor:"text-purple-700",borderColor:"border-purple-200"},participation:{icon:G,bgColor:"bg-green-50",textColor:"text-green-700",borderColor:"border-green-200"},social:{icon:oe,bgColor:"bg-amber-50",textColor:"text-amber-700",borderColor:"border-amber-200"}};function fe({studentId:o}){const{t:r}=ee(),[n,l]=i.useState(""),[d,m]=i.useState([]),[p,k]=i.useState(!0),[E,u]=i.useState(null),[S,v]=i.useState(!1),[R,D]=i.useState(!1),[T,U]=i.useState("all"),[j,P]=i.useState(o||""),[V,W]=i.useState([]),[H,M]=i.useState(!1),[X,K]=i.useState(0),J=3,[a,g]=i.useState({studentId:o||"",category:"discipline",severity:"neutral",description:"",actionTaken:""}),I=i.useCallback(async()=>{if(!o)try{M(!0);const s=await re({},1);s&&s.data&&W(s.data)}catch(s){console.error("Error loading students:",s)}finally{M(!1)}},[o]),N=i.useCallback(async()=>{if(!j){k(!1);return}try{k(!0),u(null);const{clearTimeout:s}=se(15e3),t=await ce(j);s(),t&&t.data?m(t.data):(u(r("errors.invalidData")||"Format respons tidak valid"),m([]))}catch(s){console.error("Error loading behavior records:",s),s instanceof Error?s.name==="AbortError"||s.message.includes("timeout")?u(r("errors.timeout")||"Waktu permintaan habis"):u(s.message||r("errors.loadingRecords")||"Gagal memuat data"):u(r("errors.loadingRecords")||"Gagal memuat data"),m([])}finally{k(!1)}},[j,r]),Q=async s=>{if(s.preventDefault(),!a.studentId){C.error(r("behavior.noStudentSelected")||"Silakan pilih siswa terlebih dahulu");return}if(!a.description.trim()){C.error(r("behavior.descriptionRequired")||"Deskripsi tidak boleh kosong");return}try{D(!0);const t={studentId:a.studentId,date:new Date().toISOString().split("T")[0],type:a.severity==="positive"?"positive":"negative",description:a.description,category:a.category,severity:a.severity,reporter:{id:"system",name:"System"},...a.actionTaken?{actionTaken:a.actionTaken}:{}};if(await me(t))C.success(r("behavior.recordCreated")||"Catatan berhasil dibuat"),v(!1),a.studentId!==j?P(a.studentId):N(),g({studentId:a.studentId,category:"discipline",severity:"neutral",description:"",actionTaken:""});else throw new Error("Failed to create record")}catch(t){console.error("Error creating behavior record:",t),C.error(t instanceof Error?t.message:r("behavior.createFailed")||"Gagal membuat catatan")}finally{D(!1)}},Y=s=>{const t=s.target.value;g({...a,studentId:t})},Z=()=>{X<J?(K(s=>s+1),N()):u(r("errors.maxRetriesReached")||"Batas percobaan telah tercapai")};i.useEffect(()=>{N()},[N]),i.useEffect(()=>{o&&(P(o),g(s=>({...s,studentId:o})))},[o]),i.useEffect(()=>{S&&I()},[S,I]);const $=d.filter(s=>{const t=s.description.toLowerCase().includes(n.toLowerCase()),h=T==="all"||s.category===T;return t&&h}),w=(()=>{const s=d.filter(x=>new Date(x.date).getMonth()===new Date().getMonth()),t=d.filter(x=>x.severity==="positive"),h=d.filter(x=>x.severity==="major");return{thisMonth:s.length,positive:t.length,needsAttention:h.length,total:d.length}})();return p?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-gradient-to-br from-indigo-600 to-purple-700 w-12 h-12 rounded-lg flex items-center justify-center shadow-lg mr-4 animate-pulse",children:e.jsx(B,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 w-48 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 w-64 bg-gray-200 rounded"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[...Array(4)].map((s,t)=>e.jsx("div",{className:"bg-white p-5 rounded-xl shadow-sm animate-pulse border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-gray-200 mr-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded"})]})]})},t))}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsx("div",{className:"animate-pulse space-y-6",children:[...Array(3)].map((s,t)=>e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded"}),e.jsx("div",{className:"h-6 w-20 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"h-4 w-full bg-gray-200 rounded"})]},t))})})]}):E?e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-red-100 p-6 rounded-xl border border-red-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-red-100 rounded-full p-2",children:e.jsx(b,{className:"h-6 w-6 text-red-600"})}),e.jsx("h3",{className:"text-xl font-bold text-red-700",children:r("behavior.errorLoading")||"Gagal memuat catatan perilaku"})]}),e.jsx("p",{className:"text-red-600 mb-6 pl-11",children:E}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:Z,className:"flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors shadow-sm",children:[e.jsx(te,{className:"h-4 w-4 mr-2 animate-spin-slow"}),r("actions.retry")||"Coba Lagi"]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-indigo-600 to-purple-700 w-12 h-12 rounded-lg flex items-center justify-center shadow-lg mr-4",children:e.jsx(B,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600",children:r("behavior.title")||"Behavior Records"}),e.jsx("p",{className:"text-gray-500 mt-1",children:r("behavior.subtitle")||"Track and manage student behavior patterns"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-indigo-100 hover:shadow transition-shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-indigo-50 rounded-lg mr-4",children:e.jsx(b,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500",children:r("behavior.stats.total")||"Total Records"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-gray-900",children:w.total})]})]})}),e.jsx("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-green-100 hover:shadow transition-shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-green-50 rounded-lg mr-4",children:e.jsx(z,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500",children:r("behavior.stats.positive")||"Positive"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-green-600",children:w.positive})]})]})}),e.jsx("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-blue-100 hover:shadow transition-shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg mr-4",children:e.jsx(A,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500",children:r("behavior.stats.thisMonth")||"This Month"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-blue-600",children:w.thisMonth})]})]})}),e.jsx("div",{className:"bg-white p-5 rounded-xl shadow-sm border border-red-100 hover:shadow transition-shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-red-50 rounded-lg mr-4",children:e.jsx(b,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500",children:r("behavior.stats.needsAttention")||"Needs Attention"}),e.jsx("p",{className:"mt-1 text-2xl font-bold text-red-600",children:w.needsAttention})]})]})})]}),e.jsx("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-200 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ae,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:r("behavior.search")||"Search records...",value:n,onChange:s=>l(s.target.value),className:"pl-10 pr-4 py-2.5 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"bg-gray-100 p-1 rounded-lg flex",children:["all","attendance","discipline","participation","social"].map(s=>e.jsx("button",{onClick:()=>U(s),className:c("px-3 py-1.5 rounded-md text-sm font-medium transition-all duration-200",T===s?"bg-indigo-600 text-white shadow-sm":"text-gray-700 hover:bg-gray-200"),children:s==="all"?r("behavior.all")||"All":r(`behavior.category.${s}`)||s},s))}),e.jsxs("button",{onClick:()=>v(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 shadow-sm transition-all duration-200 transform hover:scale-105",children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),r("behavior.newRecord")||"New Record"]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"divide-y divide-gray-200",children:$.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"mx-auto h-20 w-20 text-gray-400 mb-4",children:e.jsx(b,{className:"h-full w-full"})}),e.jsx("p",{className:"text-gray-500 font-medium mb-4",children:r("behavior.noRecordsFound")||"No records found"}),e.jsxs("button",{onClick:()=>v(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 shadow-sm transition-colors",children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),r("behavior.addFirstRecord")||"Add First Record"]})]}):$.map(s=>{var x;const t=_[s.category],h=O[s.severity];return e.jsx("div",{className:"group hover:bg-gray-50 transition-colors duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:c("p-2 rounded-lg",t.bgColor),children:e.jsx(t.icon,{className:c("h-5 w-5",t.textColor)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:ie(new Date(s.date),"PPP")}),e.jsx("span",{className:c("ml-2 text-xs px-2 py-0.5 rounded-full font-medium",t.bgColor,t.textColor),children:r(`behavior.category.${s.category}`)||s.category})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:s.description})]})]}),e.jsxs("div",{className:c("px-3 py-1.5 rounded-lg text-xs font-medium flex items-center",h.bgColor,h.textColor,`border ${h.borderColor}`),children:[e.jsx(h.icon,{className:"h-4 w-4 mr-1.5"}),r(`behavior.severity.${s.severity}`)||s.severity]})]}),s.actionTaken&&e.jsx("div",{className:"mt-4 pl-11",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[r("behavior.actionTaken")||"Action:",":"]})," ",s.actionTaken]})}),e.jsxs("div",{className:"mt-4 pl-11 flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[r("behavior.reportedBy")||"Reported by",": ",((x=s.reporter)==null?void 0:x.name)||"System"]}),e.jsxs("button",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-sm font-medium text-indigo-600 hover:text-indigo-700 flex items-center",children:[r("behavior.viewDetails")||"View Details",e.jsx(ne,{className:"h-4 w-4 ml-1.5"})]})]})]})},s.id)})})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto animate-fadeIn",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 sticky top-0 bg-white z-10",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:r("behavior.createNewRecord")||"Create New Record"}),e.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:text-gray-500 p-1 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(le,{className:"h-5 w-5"})})]})}),e.jsxs("form",{onSubmit:Q,className:"p-6 space-y-5",children:[!o&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{htmlFor:"student-select",className:"block text-sm font-medium text-gray-700",children:[r("behavior.selectStudent")||"Select Student",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{id:"student-select",value:a.studentId,onChange:Y,className:"w-full border border-gray-300 rounded-lg shadow-sm py-2 px-3 appearance-none bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0,children:[e.jsx("option",{value:"",children:r("behavior.selectStudentPrompt")||"Select a student..."}),H?e.jsx("option",{disabled:!0,children:r("common.loading")||"Loading..."}):V.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.tingkat||s.grade," ",s.kelas||s.class]},s.id))]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(de,{className:"h-5 w-5 text-gray-400"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("behavior.category.label")||"Category"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["attendance","discipline","participation","social"].map(s=>{const t=_[s];return e.jsxs("div",{onClick:()=>g({...a,category:s}),className:c("p-3 rounded-lg border cursor-pointer flex items-center transition-all",a.category===s?`${t.borderColor} ${t.bgColor} shadow-sm`:"border-gray-200 hover:border-gray-300"),children:[e.jsx("div",{className:c("p-2 rounded-lg mr-3",t.bgColor),children:e.jsx(t.icon,{className:c("h-4 w-4",t.textColor)})}),e.jsx("span",{className:"text-sm font-medium",children:r(`behavior.category.${s}`)||s})]},s)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("behavior.severity.label")||"Severity"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["positive","neutral","minor","major"].map(s=>{const t=O[s];return e.jsxs("div",{onClick:()=>g({...a,severity:s}),className:c("p-3 rounded-lg border cursor-pointer flex items-center transition-all",a.severity===s?`${t.borderColor} ${t.bgColor} shadow-sm`:"border-gray-200 hover:border-gray-300"),children:[e.jsx("div",{className:c("p-2 rounded-lg mr-3",t.bgColor),children:e.jsx(t.icon,{className:c("h-4 w-4",t.textColor)})}),e.jsx("span",{className:"text-sm font-medium",children:r(`behavior.severity.${s}`)||s})]},s)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("behavior.description")||"Description"}),e.jsx("textarea",{value:a.description,onChange:s=>g({...a,description:s.target.value}),rows:3,className:"w-full border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:r("behavior.descriptionPlaceholder")||"Describe the behavior..."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[r("behavior.actionTaken")||"Action Taken",e.jsxs("span",{className:"text-gray-400 text-xs ml-1",children:["(",r("common.optional")||"Optional",")"]})]}),e.jsx("textarea",{value:a.actionTaken||"",onChange:s=>g({...a,actionTaken:s.target.value}),rows:2,className:"w-full border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:r("behavior.actionTakenPlaceholder")||"Describe any actions taken..."})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3 border-t mt-6",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none",children:r("common.cancel")||"Cancel"}),e.jsx("button",{type:"submit",disabled:R||!a.description.trim(),className:c("px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white","bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700","focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500","transition-all duration-200",(R||!a.description.trim())&&"opacity-50 cursor-not-allowed"),children:R?e.jsxs("span",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r("common.saving")||"Saving..."]}):r("common.save")||"Save"})]})]})]})})]})}export{fe as default};
