import{u as Q,j as e,c as R,l as W}from"./index-DSnDXcoI.js";import{r as n}from"./react-vendor-BzbKlFBU.js";import{T as U,a0 as X,A as O,r as Y,E as Z,a1 as B,J as ee,t as se,a2 as V,D as q}from"./ui-vendor-BdkMv6fW.js";function te(r,g={}){const{initialSortField:S="name",initialSortDirection:k="asc",itemsPerPage:u=10,enableVirtualization:t=!1}=g,[m,w]=n.useState(""),[p,C]=n.useState(S),[v,N]=n.useState(k),[x,P]=n.useState(1),[E,j]=n.useState("all"),[c,f]=n.useState(new Set),M=n.useMemo(()=>r.filter(a=>{var b;const l=m===""||a.name.toLowerCase().includes(m.toLowerCase())||((b=a.email)==null?void 0:b.toLowerCase().includes(m.toLowerCase()))||`${a.tingkat||a.grade} ${a.kelas||a.class}`.toLowerCase().includes(m.toLowerCase()),d=E==="all"||a.academicStatus===E;return l&&d}),[r,m,E]),I=n.useMemo(()=>[...M].sort((a,l)=>{let d,b;p==="class"?(d=`${a.tingkat||a.grade} ${a.kelas||a.class}`,b=`${l.tingkat||l.grade} ${l.kelas||l.class}`):(d=a[p],b=l[p]),d===void 0&&(d=""),b===void 0&&(b=""),typeof d=="string"&&typeof b=="string"&&(d=d.toLowerCase(),b=b.toLowerCase());let H=0;return d>b&&(H=1),d<b&&(H=-1),v==="asc"?H:-H}),[M,p,v]),y=Math.ceil(I.length/u),z=(x-1)*u,D=z+u,h=n.useMemo(()=>t?I:I.slice(z,D),[I,z,D,t]),L=n.useCallback(a=>{p===a?N(l=>l==="asc"?"desc":"asc"):(C(a),N("asc")),P(1)},[p]),T=n.useCallback(a=>{w(a),P(1)},[]),A=n.useCallback(a=>{j(a),P(1)},[]),s=n.useCallback(()=>{c.size===h.length?f(new Set):f(new Set(h.map(a=>J(a))))},[c.size,h]),o=n.useCallback(a=>{f(l=>{const d=new Set(l);return d.has(a)?d.delete(a):d.add(a),d})},[]),i=n.useCallback(a=>{P(Math.max(1,Math.min(a,y)))},[y]),F=n.useCallback(()=>{f(new Set)},[]),$=n.useCallback(()=>r.filter(a=>{const l=J(a);return c.has(l)}),[r,c]),K=n.useMemo(()=>({totalStudents:r.length,filteredStudents:M.length,currentPageStudents:h.length,selectedCount:c.size,totalPages:y,currentPage:x,hasNextPage:x<y,hasPrevPage:x>1}),[r.length,M.length,h.length,c.size,y,x]);return{students:h,allFilteredStudents:I,selectedStudents:$(),searchTerm:m,sortField:p,sortDirection:v,currentPage:x,statusFilter:E,selectedStudentIds:c,handleSort:L,handleSearch:T,handleStatusFilter:A,handleSelectAll:s,handleSelectStudent:o,handlePageChange:i,clearSelection:F,metrics:K,setSearchTerm:w,setSortField:C,setSortDirection:N,setCurrentPage:P,setStatusFilter:j,setSelectedStudents:f}}function ae(){const[r,g]=n.useState(new Set),S=n.useCallback(m=>{g(w=>new Set(w).add(m))},[]),k=n.useCallback(m=>r.has(m),[r]),u=n.useCallback(m=>{g(w=>{const p=new Set(w);return p.delete(m),p})},[]),t=n.useCallback(()=>{g(new Set)},[]);return{hasImageError:k,handleImageError:S,clearImageError:u,clearAllImageErrors:t}}const J=r=>r.studentId||r.id||r.name,re=r=>r.split(" ").map(g=>g[0]).join("").toUpperCase().slice(0,2),ne=r=>r>=80?"bg-green-500":r>=60?"bg-yellow-500":"bg-red-500",_=(r,g)=>r.id||r.email||`${r.name}-${r.tingkat||r.grade}-${r.kelas||r.class}`||`student-${g}`,G={good:{color:"text-green-700",bgColor:"bg-green-50",borderColor:"border-green-200",icon:Z},warning:{color:"text-yellow-700",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",icon:Y},critical:{color:"text-red-700",bgColor:"bg-red-50",borderColor:"border-red-200",icon:O}};function oe({students:r,onClick:g,onEdit:S,onDelete:k,onBulkAction:u}){const{t}=Q(),{hasImageError:m,handleImageError:w}=ae(),[p,C]=n.useState(!1),{students:v,selectedStudents:N,selectedStudentIds:x,sortField:P,sortDirection:E,currentPage:j,metrics:c,handleSort:f,handleSelectAll:M,handleSelectStudent:I,handlePageChange:y}=te(r,{itemsPerPage:50,initialSortField:"name"}),z="/assets/images/default-avatar.png",D=(s,o,i)=>{s.stopPropagation(),i==="edit"&&S?S(o):i==="delete"&&k?k(o):i==="view"&&g(o)},h=s=>P!==s?null:E==="asc"?e.jsx(V,{className:"h-4 w-4 ml-1"}):e.jsx(q,{className:"h-4 w-4 ml-1"}),L=s=>s===void 0?e.jsx("span",{className:"text-gray-400 text-sm",children:"-"}):e.jsxs("div",{className:"flex items-center space-x-2 min-w-[100px]",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:R("h-full rounded-full",ne(s)),style:{width:`${s}%`}})})]}),T=()=>{N.length>0&&C(!0)},A=async()=>{try{const s=N.map(i=>i.id||i.studentId).filter(Boolean);if(s.length===0){console.error("No valid student IDs found"),C(!1);return}const o=await W(s);u==null||u(N,"delete"),console.log(o.message),o.notFound&&o.notFound.length>0&&console.warn("Students not found:",o.notFound)}catch(s){console.error("Error during bulk delete:",s)}C(!1)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[x.size>0&&e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[x.size," ",t("selected")||"terpilih"]}),e.jsxs("button",{onClick:T,className:"px-3 py-1 text-sm bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center space-x-1",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx("span",{children:t("actions.delete")||"Hapus"})]}),e.jsxs("button",{onClick:()=>u==null?void 0:u(N,"export"),className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded-md hover:bg-indigo-700 flex items-center space-x-1",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:t("actions.export")||"Export"})]})]})})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full mx-4 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(O,{className:"h-6 w-6 text-red-600"})}),e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:t("confirm.deleteMultiple")||"Hapus Siswa"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-700 mb-3",children:t("confirm.deleteMultipleMessage")||`Apakah Anda yakin ingin menghapus ${x.size} siswa yang dipilih? Data siswa akan dipindahkan ke sampah dan dapat dipulihkan nanti.`}),e.jsxs("div",{className:"bg-gray-50 rounded-md p-3 max-h-48 overflow-y-auto",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:t("confirm.studentsToDelete")||"Siswa yang akan dihapus:"}),e.jsx("ul",{className:"space-y-1",children:N.map((s,o)=>e.jsxs("li",{className:"text-sm text-gray-700 flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full mr-2 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[s.name,s.id&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",s.id,")"]}),(s.tingkat||s.grade)&&(s.kelas||s.class)&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["- ",s.tingkat||s.grade," ",s.kelas||s.class]})]})]},_(s,o)))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>C(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:t("actions.cancel")||"Batal"}),e.jsxs("button",{onClick:A,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[t("actions.delete")||"Hapus"," (",x.size,")"]})]})]})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:["              ",e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:v.length>0&&x.size===v.length,onChange:M,className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("table.avatar")||"Avatar"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("button",{onClick:()=>f("id"),className:"flex items-center hover:text-gray-700 focus:outline-none",children:[t("table.studentId")||"ID Siswa",h("id")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("button",{onClick:()=>f("name"),className:"flex items-center hover:text-gray-700 focus:outline-none",children:[t("table.name")||"Nama",h("name")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("button",{onClick:()=>f("class"),className:"flex items-center hover:text-gray-700 focus:outline-none",children:[t("table.class")||"Kelas",h("class")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("button",{onClick:()=>f("email"),className:"flex items-center hover:text-gray-700 focus:outline-none",children:[t("table.email")||"Email",h("email")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("button",{onClick:()=>f("academicStatus"),className:"flex items-center hover:text-gray-700 focus:outline-none",children:[t("table.status")||"Status",h("academicStatus")]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("button",{onClick:()=>f("mentalHealthScore"),className:"flex items-center hover:text-gray-700 focus:outline-none",children:[t("table.mentalHealth")||"Kesehatan Mental",h("mentalHealthScore")]})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("table.actions")||"Aksi"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map((s,o)=>{const i=_(s,o),F=s.academicStatus||"warning",$=G[F]||G.warning,K=s.avatar||s.photo||z,a=m(i);return e.jsxs("tr",{onClick:()=>g(s),className:"hover:bg-gray-50 cursor-pointer transition-colors duration-150",children:["                  ",e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:x.has(i),onChange:()=>I(i),onClick:l=>l.stopPropagation(),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"})}),e.jsx("td",{className:"px-4 py-4",children:a?e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center ring-2 ring-gray-100",children:e.jsx("span",{className:"text-xs font-medium text-indigo-600",children:re(s.name)})}):e.jsx("img",{src:K,alt:s.name,className:"h-10 w-10 rounded-full object-cover ring-2 ring-gray-100",onError:()=>w(i)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-mono text-gray-900",children:s.id||"-"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate max-w-[200px]",children:s.name}),s.email&&e.jsx("span",{className:"text-xs text-gray-500 truncate max-w-[200px]",children:s.email})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"text-sm text-gray-900",children:[s.tingkat||s.grade," ",s.kelas||s.class]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:"text-sm text-gray-900 truncate max-w-[150px] block",children:s.email||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("span",{className:R("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",$.bgColor,$.color,`border ${$.borderColor}`),children:[e.jsx($.icon,{className:"w-3 h-3 mr-1"}),t(`status.${F}`)]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:L(s.mentalHealthScore)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:l=>D(l,s,"view"),className:"text-gray-600 hover:text-indigo-600 transition-colors p-1",title:t("actions.view")||"Lihat",children:e.jsx(B,{className:"h-4 w-4"})}),S&&e.jsx("button",{onClick:l=>D(l,s,"edit"),className:"text-gray-600 hover:text-indigo-600 transition-colors p-1",title:t("actions.edit")||"Edit",children:e.jsx(ee,{className:"h-4 w-4"})}),k&&e.jsx("button",{onClick:l=>D(l,s,"delete"),className:"text-gray-600 hover:text-red-600 transition-colors p-1",title:t("actions.delete")||"Hapus",children:e.jsx(U,{className:"h-4 w-4"})})]})})]},i)})})]}),v.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(se,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:t("table.noResults")||"Tidak ada siswa ditemukan"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("table.noResultsDesc")||"Coba ubah filter atau kata kunci pencarian"})]})]}),"      ",c.totalPages>1&&e.jsx("div",{className:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>y(j-1),disabled:!c.hasPrevPage,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:t("pagination.previous")||"Sebelumnya"}),e.jsx("button",{onClick:()=>y(j+1),disabled:!c.hasNextPage,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:t("pagination.next")||"Selanjutnya"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:[t("pagination.showing")||"Menampilkan"," ",e.jsx("span",{className:"font-medium",children:(j-1)*50+1})," ",t("pagination.to")||"sampai"," ",e.jsx("span",{className:"font-medium",children:Math.min(j*50,c.filteredStudents)})," ",t("pagination.of")||"dari"," ",e.jsx("span",{className:"font-medium",children:c.filteredStudents})," ",t("pagination.results")||"hasil"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>y(j-1),disabled:!c.hasPrevPage,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:t("pagination.previous")||"Sebelumnya"}),e.jsx(V,{className:"h-5 w-5 rotate-[-90deg]","aria-hidden":"true"})]}),Array.from({length:Math.min(5,c.totalPages)},(s,o)=>{const i=o+1;return e.jsx("button",{onClick:()=>y(i),className:R("relative inline-flex items-center px-4 py-2 border text-sm font-medium",j===i?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"),children:i},i)}),e.jsxs("button",{onClick:()=>y(j+1),disabled:!c.hasNextPage,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"sr-only",children:t("pagination.next")||"Selanjutnya"}),e.jsx(q,{className:"h-5 w-5 rotate-[-90deg]","aria-hidden":"true"})]})]})})]})]})})]})}export{oe as S,J as g};
