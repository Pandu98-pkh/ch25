var k=Object.defineProperty;var P=(o,s,t)=>s in o?k(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t;var E=(o,s,t)=>P(o,typeof s!="symbol"?s+"":s,t);import{_ as R,j as e}from"./index-D-hSlWQg.js";import{r as h}from"./react-vendor-BzbKlFBU.js";import{t as F,b1 as j,b2 as L,A as z,e as C}from"./ui-vendor-BdkMv6fW.js";class O{constructor(s="/api"){E(this,"baseUrl");this.baseUrl=s}async uploadImage(s,t={}){const{useCompression:a=!0,maxSizeMB:l=5,fallbackToBase64:n=!0,onProgress:r}=t;if(!s.type.startsWith("image/"))throw new Error("File must be an image");if(s.size>l*1024*1024)throw new Error(`File size must be less than ${l}MB`);try{r&&r(10);const c=new FormData;c.append("image",s);const i=await fetch(`${this.baseUrl}/images/upload`,{method:"POST",body:c});if(r&&r(80),i.ok){const d=await i.json();return r&&r(100),{type:"file",data:d}}else throw new Error(`Upload failed: ${i.statusText}`)}catch(c){if(console.warn("File upload failed, trying base64 fallback:",c),n){r&&r(50);const{compressImageToBase64:i,getOptimalCompressionSettings:d}=await R(async()=>{const{compressImageToBase64:y,getOptimalCompressionSettings:x}=await import("./imageUtils-CgHCGrTH.js");return{compressImageToBase64:y,getOptimalCompressionSettings:x}},[]),m=d(s.size),g=await i(s,m);return r&&r(100),{type:"base64",data:g}}else throw c}}getImageUrl(s,t){const a=t?`?size=${t}`:"";return`${this.baseUrl}/images/${s}${a}`}async deleteImage(s){try{return(await fetch(`${this.baseUrl}/images/${s}`,{method:"DELETE"})).ok}catch(t){return console.error("Error deleting image:",t),!1}}async validateImage(s){if(!s.type.startsWith("image/"))return{isValid:!1,error:"File must be an image"};const t=5*1024*1024;if(s.size>t)return{isValid:!1,error:"File size must be less than 5MB"};try{const a=new Image,l=URL.createObjectURL(s);return new Promise(n=>{a.onload=()=>{URL.revokeObjectURL(l),n({isValid:!0,info:{width:a.width,height:a.height,size:s.size,type:s.type}})},a.onerror=()=>{URL.revokeObjectURL(l),n({isValid:!1,error:"Invalid image file"})},a.src=l})}catch{return{isValid:!1,error:"Failed to validate image"}}}}const _=new O,$=()=>{const[o,s]=h.useState(!1),[t,a]=h.useState(0),[l,n]=h.useState(null);return{uploadImage:async(c,i={})=>{s(!0),a(0),n(null);try{return await _.uploadImage(c,{...i,onProgress:a})}catch(d){const m=d instanceof Error?d.message:"Upload failed";return n(m),null}finally{s(!1),a(0)}},uploading:o,progress:t,error:l,clearError:()=>n(null)}},V=({currentImage:o,onImageChange:s,label:t="Profile Photo",className:a=""})=>{const l=h.useRef(null),{uploadImage:n,uploading:r,progress:c,error:i,clearError:d}=$(),[m,g]=h.useState(o),y=async p=>{var U,v,N;const f=(U=p.target.files)==null?void 0:U[0];if(f){d();try{const b=URL.createObjectURL(f);g(b);const u=await n(f,{maxSizeMB:5,fallbackToBase64:!0,useCompression:!0});if(u)if(u.type==="file"&&typeof u.data=="object"){const I=u.data;s({type:"file",url:((v=I.file_info)==null?void 0:v.url)||"",filename:(N=I.file_info)==null?void 0:N.filename})}else u.type==="base64"&&typeof u.data=="string"&&s({type:"base64",url:u.data});URL.revokeObjectURL(b)}catch(b){console.error("Error uploading image:",b),g(o)}l.current&&(l.current.value="")}},x=()=>{var p;(p=l.current)==null||p.click()},w=()=>m&&m.trim()!==""?m:null,S=()=>w()!==null;return e.jsxs("div",{className:`space-y-4 ${a}`,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative w-32 h-32",children:[S()?e.jsx("img",{src:w(),alt:"Preview",className:"w-full h-full object-cover rounded-full border-2 border-gray-300",onError:p=>{const f=p.target;f.style.display="none",g("")}}):e.jsx("div",{className:"w-full h-full rounded-full border-2 border-gray-300 bg-gray-100 flex items-center justify-center",children:e.jsx(F,{className:"w-16 h-16 text-gray-400"})}),r&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center",children:e.jsxs("div",{className:"text-white text-center",children:[e.jsx(j,{className:"w-6 h-6 mx-auto mb-1 animate-pulse"}),e.jsxs("div",{className:"text-xs",children:[c,"%"]})]})}),e.jsx("button",{type:"button",onClick:x,disabled:r,className:"absolute bottom-0 right-0 bg-blue-600 text-white rounded-full p-2 shadow-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:e.jsx(L,{className:"w-4 h-4"})})]}),e.jsx("button",{type:"button",onClick:x,disabled:r,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-4 h-4 animate-pulse"}),e.jsxs("span",{children:["Uploading... ",c,"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{children:"Choose Photo"})]})}),e.jsx("input",{ref:l,type:"file",accept:"image/*",onChange:y,className:"hidden"})]}),i&&e.jsxs("div",{className:"flex items-center space-x-2 text-red-600 text-sm",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:i})]}),!r&&!i&&m!==o&&e.jsxs("div",{className:"flex items-center space-x-2 text-green-600 text-sm",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:"Image uploaded successfully"})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-center space-y-1",children:[e.jsx("p",{children:"Supported formats: JPG, PNG, GIF, WebP"}),e.jsx("p",{children:"Maximum size: 5MB"}),e.jsx("p",{children:"Recommended: Square images work best"})]})]})};export{V as I};
