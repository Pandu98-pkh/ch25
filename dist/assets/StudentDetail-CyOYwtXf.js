import{m as $,j as e,c as l,u as L,n as M}from"./index-BPryJHl5.js";import{r as o,e as O,u as B}from"./react-vendor-Brf1c7dg.js";import V from"./SessionsPage-DJ5msRZf.js";import U from"./MentalHealthPage-BN6gwC0J.js";import H from"./BehaviorPage-IYuX3KAt.js";import F from"./CareerPage-B9rXNtCV.js";import{A as D,$ as G,t as w,n as y,a0 as z,r as J,E as K,w as W,y as q,a3 as u}from"./ui-vendor-iM6TVctI.js";import"./jspdf.plugin.autotable-CFo8yjKg.js";import"./toast-M3i0mrg7.js";const k=s=>{const a=new Date().toISOString().split("T")[0],t={studentId:s,reportDate:a,summary:{totalSessions:5,mentalHealthScore:78,behaviorRecords:8,status:"good"},sessions:[{id:"1",date:"2025-03-15",type:"academic",notes:"Diskusi tentang kemajuan akademik dan strategi belajar",outcome:"positive"},{id:"2",date:"2025-02-20",type:"behavioral",notes:"Membahas interaksi sosial di kelas",outcome:"neutral"}],assessments:[{id:"1",date:"2025-03-20",score:82,category:"routine",notes:"Perkembangan positif dalam manajemen stres"},{id:"2",date:"2025-02-10",score:75,category:"academic",notes:"Menunjukkan kecemasan terkait ujian"}],behavior:[{id:"1",date:"2025-03-25",type:"positive",description:"Membantu teman sekelas dalam proyek kelompok",severity:"mild"},{id:"2",date:"2025-02-15",type:"negative",description:"Terlambat mengumpulkan tugas",severity:"minor"}]};return new Blob([JSON.stringify(t,null,2)],{type:"application/json"})};let C=!0;const Q=async s=>{try{if(C){console.log("Using mock report data");const a=k(s.studentId);return b(a,`student_report_${s.studentId}_${new Date().toISOString().slice(0,10)}.json`),a}try{const a=await $.get(`/students/${s.studentId}/report/`,{params:s,responseType:"blob"}),t=new Blob([a.data],{type:a.headers["content-type"]||"application/json"}),n=`student_report_${s.studentId}_${new Date().toISOString().slice(0,10)}.json`;return b(t,n),t}catch(a){throw console.error("API error generating report:",a),a}}catch(a){console.error("Error generating report:",a),C=!0;const t=k(s.studentId),n=`student_report_${s.studentId}_${new Date().toISOString().slice(0,10)}.json`;return b(t,n),t}},b=(s,a)=>{try{const t=window.URL.createObjectURL(s),n=document.createElement("a");n.href=t,n.download=a,document.body.appendChild(n),n.click(),setTimeout(()=>{n.remove(),window.URL.revokeObjectURL(t)},100)}catch(t){throw console.error("Error triggering download:",t),new Error("Gagal mengunduh file")}},I=o.createContext(void 0);function E(){const s=o.useContext(I);if(!s)throw new Error("Tabs components must be used within a Tabs provider");return s}function X({defaultValue:s,children:a,className:t}){const[n,c]=o.useState(s);return e.jsx(I.Provider,{value:{value:n,onValueChange:c},children:e.jsx("div",{className:l("w-full",t),"data-tab-value":n,children:a})})}function Y({children:s,className:a}){return e.jsx("div",{className:l("flex space-x-1",a),children:s})}function x({value:s,children:a,className:t}){const{value:n,onValueChange:c}=E(),m=n===s;return e.jsx("button",{className:l("px-3 py-2 text-sm font-medium rounded-md","data-[state=active]:bg-brand-100 data-[state=active]:text-brand-900","hover:bg-gray-100",t),"data-state":m?"active":"inactive","data-value":s,onClick:()=>c(s),children:a})}function g({value:s,children:a,className:t}){const{value:n}=E();return n===s?e.jsx("div",{className:l("mt-2",t),"data-value":s,children:a}):null}const S={good:{color:"text-green-700",bgColor:"bg-green-50",borderColor:"border-green-200",icon:K},warning:{color:"text-yellow-700",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",icon:J},critical:{color:"text-red-700",bgColor:"bg-red-50",borderColor:"border-red-200",icon:D}};function de(){const{id:s}=O(),a=B(),[t,n]=o.useState(null),[c,m]=o.useState(!0),[p,v]=o.useState(null),[h,j]=o.useState(!1),{t:r}=L(),[T,A]=o.useState(!1),f=o.useCallback(async()=>{try{m(!0),v(null);const d=await M(s);n(d)}catch(d){console.error("Error loading student:",d),v(r("errors.loadingStudent"))}finally{m(!1)}},[s,r]);o.useEffect(()=>{s&&f()},[s,f]);const P=async()=>{if(t!=null&&t.studentId)try{j(!0);const d={studentId:t.studentId,includeAssessments:!0,includeBehavior:!0,includeSessions:!0};await new Promise(_=>setTimeout(_,1500)),await Q(d)}catch(d){console.error("Error generating report:",d)}finally{j(!1)}};if(c)return e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"h-10 w-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-7 bg-gray-200 rounded w-1/3 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]}),e.jsx("div",{className:"h-40 bg-gray-200 rounded-xl"}),e.jsx("div",{className:"h-12 bg-gray-200 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 rounded-xl"})]});if(p||!t)return e.jsxs("div",{className:"text-center py-12 bg-white rounded-xl shadow-md border border-red-100",children:[e.jsx(D,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 font-medium mb-4",children:p||r("errors.studentNotFound")}),e.jsx("button",{onClick:()=>a("/app/students"),className:"px-4 py-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors",children:r("actions.backToStudents")})]});const N=t.academicStatus||"warning",i=S[N]||S.warning,R=t.avatar||t.photo||"/assets/images/default-avatar.png";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-indigo-500 to-purple-500"}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",title:r("actions.goBack","Kembali"),children:e.jsx(G,{className:"h-5 w-5 text-gray-500"})}),e.jsxs("div",{className:"flex items-center",children:[T?e.jsx("div",{className:"h-16 w-16 rounded-full bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center ring-2 ring-gray-100",children:e.jsx(w,{className:"h-8 w-8 text-indigo-400"})}):e.jsx("img",{src:R,alt:t.name,className:"h-16 w-16 rounded-full object-cover ring-2 ring-gray-100",onError:()=>A(!0)}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.name}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(y,{className:"h-4 w-4 text-indigo-500 mr-1.5"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r("students.tingkat")," ",t.tingkat||t.grade," â€¢ ",r("students.kelas")," ",t.kelas||t.class]})]})]})]})]}),e.jsx("button",{onClick:P,disabled:h,className:l("inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium text-white transition-all duration-300",h?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 shadow-sm"),children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r("actions.generating")]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),r("actions.generateReport")]})})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsx("div",{className:l("p-4 rounded-xl border",i.borderColor,i.bgColor),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:l("p-2 rounded-full",i.bgColor==="bg-green-50"?"bg-green-100":i.bgColor==="bg-yellow-50"?"bg-yellow-100":"bg-red-100"),children:e.jsx(i.icon,{className:l("h-5 w-5",i.color)})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:r("studentDetail.academicStatus")}),e.jsx("p",{className:l("font-semibold",i.color),children:r(`status.${N}`)})]})]})}),e.jsx("div",{className:"p-4 rounded-xl border border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 rounded-full bg-indigo-50",children:e.jsx(W,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:r("studentDetail.email")}),e.jsx("p",{className:"font-medium text-gray-900 truncate",children:t.email})]})]})}),e.jsx("div",{className:"p-4 rounded-xl border border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 rounded-full bg-green-50",children:e.jsx(w,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:r("studentDetail.studentId","Nomor Induk Siswa")}),e.jsx("p",{className:"font-medium text-gray-900",children:t.studentId||r("studentDetail.notAvailable","N/A")})]})]})}),e.jsx("div",{className:"p-4 rounded-xl border border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 rounded-full bg-purple-50",children:e.jsx(y,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:r("studentDetail.tingkat")}),e.jsx("p",{className:"font-medium text-gray-900",children:t.tingkat||t.grade})]})]})}),e.jsx("div",{className:"p-4 rounded-xl border border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 rounded-full bg-blue-50",children:e.jsx(q,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:r("studentDetail.kelas")}),e.jsx("p",{className:"font-medium text-gray-900",children:t.kelas||t.class})]})]})})]})]}),e.jsxs(X,{defaultValue:"sessions",className:"space-y-6",children:[e.jsxs(Y,{className:"bg-white shadow-sm rounded-xl p-1.5 flex w-full border border-gray-200",children:[e.jsxs(x,{value:"sessions",className:"rounded-lg py-2.5 px-4 data-[state=active]:bg-indigo-600 data-[state=active]:text-white data-[state=active]:shadow-sm flex-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),r("nav.sessions")]}),e.jsxs(x,{value:"mental-health",className:"rounded-lg py-2.5 px-4 data-[state=active]:bg-indigo-600 data-[state=active]:text-white data-[state=active]:shadow-sm flex-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),r("nav.mentalHealth")]}),e.jsxs(x,{value:"behavior",className:"rounded-lg py-2.5 px-4 data-[state=active]:bg-indigo-600 data-[state=active]:text-white data-[state=active]:shadow-sm flex-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),r("nav.behavior")]}),e.jsxs(x,{value:"career",className:"rounded-lg py-2.5 px-4 data-[state=active]:bg-indigo-600 data-[state=active]:text-white data-[state=active]:shadow-sm flex-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),r("nav.career")]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx(g,{value:"sessions",className:"mt-0 focus:outline-none",children:e.jsx(V,{studentId:t.id})}),e.jsx(g,{value:"mental-health",className:"mt-0 focus:outline-none",children:e.jsx(U,{})}),e.jsx(g,{value:"behavior",className:"mt-0 focus:outline-none",children:e.jsx(H,{studentId:t.id})}),e.jsx(g,{value:"career",className:"mt-0 focus:outline-none",children:e.jsx(F,{studentId:t.id})})]})]})]})}export{de as default};
