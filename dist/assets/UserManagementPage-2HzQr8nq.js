import{u as G,j as e,c as P,g as z,d as $,e as se,f as re}from"./index-CPR8hM9m.js";import{r as n}from"./react-vendor-aXCYw_-y.js";import{S as te,aV as ae,E as ne,x as B,w as oe,n as H,aT as le,T as de}from"./ui-vendor-DZXJ8q2B.js";function W({initialData:s,onSubmit:c,onCancel:u}){const{t:a}=G(),[i,p]=n.useState({id:(s==null?void 0:s.id)||"",name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||"",role:(s==null?void 0:s.role)||"counselor",username:(s==null?void 0:s.username)||"",password:(s==null?void 0:s.password)||""}),[y,M]=n.useState(!1),l=m=>{const{name:I,value:w}=m.target;p(g=>({...g,[I]:w}))},S=m=>{m.preventDefault(),c(i)};return e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:a("settings.name")}),e.jsx("input",{type:"text",id:"name",name:"name",value:i.name,onChange:l,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-500 focus:border-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:a("settings.email")}),e.jsx("input",{type:"email",id:"email",name:"email",value:i.email,onChange:l,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-500 focus:border-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:a("settings.username")}),e.jsx("input",{type:"text",id:"username",name:"username",value:i.username,onChange:l,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-500 focus:border-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:a("settings.password")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:y?"text":"password",id:"password",name:"password",value:i.password,onChange:l,required:!s,placeholder:s?"Leave blank to keep current password":"",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-500 focus:border-brand-500"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-sm text-gray-400 hover:text-gray-500",onClick:()=>M(!y),children:y?"Hide":"Show"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:a("settings.role")}),e.jsxs("select",{id:"role",name:"role",value:i.role,onChange:l,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-500 focus:border-brand-500",children:[e.jsx("option",{value:"admin",children:a("settings.roles.admin")}),e.jsx("option",{value:"counselor",children:a("settings.roles.counselor")}),e.jsx("option",{value:"student",children:a("settings.roles.student")}),e.jsx("option",{value:"staff",children:a("settings.roles.staff")})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:a("settings.cancel")}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500",children:a(s?"settings.update":"settings.create")})]})]})}function xe(){const{t:s}=G(),[c,u]=n.useState([]),[a,i]=n.useState(!0),[p,y]=n.useState(""),[M,l]=n.useState(!1),[S,m]=n.useState(!1),[I,w]=n.useState(!1),[g,h]=n.useState(null),[J,E]=n.useState(!1),[R,F]=n.useState([]),A=n.useRef(null);n.useEffect(()=>{(async()=>{try{i(!0);const t=await z();u(t)}catch(t){console.error("Error loading users:",t)}finally{i(!1)}})()},[]);const L=c.filter(r=>r.name.toLowerCase().includes(p.toLowerCase())||r.email.toLowerCase().includes(p.toLowerCase())||r.role.toLowerCase().includes(p.toLowerCase())),K=async r=>{try{const t=await $(r);u([...c,t]),l(!1)}catch(t){console.error("Error creating user:",t),alert("Failed to create user. Please try again.")}},Q=async r=>{try{if(!r.id)return;const t=await se(r.id,r);u(c.map(o=>o.id===r.id?t:o)),m(!1),h(null)}catch(t){console.error("Error updating user:",t),alert("Failed to update user. Please try again.")}},X=async r=>{try{await re(r),u(c.filter(t=>t.id!==r)),w(!1),h(null)}catch(t){console.error("Error deleting user:",t),alert("Failed to delete user. Please try again.")}},Y=()=>{var r;(r=A.current)==null||r.click()},Z=r=>{var f;const t=(f=r.target.files)==null?void 0:f[0];if(!t)return;const o=new FileReader;o.onload=v=>{var x;try{const d=((x=v.target)==null?void 0:x.result).split(`
`),k=d[0].split(",").map(b=>b.trim()),T=k.indexOf("name"),V=k.indexOf("email"),O=k.indexOf("role"),q=k.indexOf("username");if(T===-1||V===-1||O===-1){alert("Invalid CSV format. The file must contain name, email, and role columns.");return}const j=[];for(let b=1;b<d.length;b++){if(!d[b].trim())continue;const C=d[b].split(",").map(ee=>ee.trim()),U={id:(c.length+j.length+1).toString(),name:C[T],email:C[V],role:C[O],username:q!==-1?C[q]:`user${c.length+j.length+1}`,password:"password123"};U.name&&U.email&&U.role&&j.push(U)}j.length>0?(F(j),E(!0)):alert("No valid users found in the CSV file.")}catch{alert("Error parsing CSV file. Please ensure the file contains valid CSV data.")}},o.readAsText(t),r.target.value=""},_=async()=>{try{for(const t of R){const{id:o,...f}=t;await $(f)}const r=await z();u(r),E(!1),F([])}catch(r){console.error("Error importing users:",r),alert("Failed to import some users. Please try again.")}},D=()=>{const r=["id","name","email","role","username"],t=c.map(({password:N,...d})=>[d.id,d.name,d.email,d.role,d.username]),o=[r.join(","),...t.map(N=>N.join(","))].join(`
`),f=new Blob([o],{type:"text/csv;charset=utf-8;"}),v=URL.createObjectURL(f),x=document.createElement("a");x.href=v,x.download="users.csv",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(v)};return a?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-8"}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden mb-8",children:[e.jsx("div",{className:"h-12 bg-gray-100 border-b border-gray-200"}),e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-10 bg-gray-100 rounded"})]})})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl px-8 py-6 shadow-lg",children:[e.jsx("h1",{className:"text-3xl font-bold",children:s("userManagement.title","User Management")}),e.jsx("p",{className:"mt-2 text-indigo-100 max-w-3xl",children:s("userManagement.subtitle","Manage users and their roles in the system")})]}),e.jsx("div",{className:"bg-white shadow-xl rounded-xl overflow-hidden mb-8 border border-gray-100",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-100 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-lg flex items-center justify-center text-white shadow-md mr-3",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("userManagement.users","Users")})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:Y,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 shadow-sm transition-all duration-200 hover:text-brand-600 hover:border-brand-500",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),s("userManagement.importUsers","Import Users")]}),e.jsx("input",{type:"file",ref:A,accept:".csv",onChange:Z,className:"hidden"}),e.jsxs("button",{onClick:D,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 shadow-sm transition-all duration-200 hover:text-brand-600 hover:border-brand-500",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),s("userManagement.exportUsers","Export Users")]}),e.jsxs("button",{onClick:()=>l(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-gradient-to-r from-brand-600 to-purple-600 hover:from-brand-700 hover:to-purple-700 shadow-md transition-all duration-200 transform hover:-translate-y-0.5",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),s("userManagement.addUser","Add User")]})]})]})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(oe,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:s("userManagement.searchUsers","Search users..."),value:p,onChange:r=>y(r.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 shadow-sm bg-white"})]}),e.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200 shadow-md",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.name","Name")}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.username","Username")}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.email","Email")}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.role","Role")}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.actions","Actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:L.map((r,t)=>e.jsxs("tr",{className:`hover:bg-indigo-50/30 transition-colors ${t%2===0?"bg-white":"bg-gray-50/50"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center border border-indigo-200",children:e.jsx(H,{className:"h-5 w-5 text-indigo-600"})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-md inline-block",children:r.username})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 mr-2"}),r.email]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:P("px-3 py-1.5 rounded-full text-xs font-medium",r.role==="admin"?"bg-purple-100 text-purple-800 border border-purple-200":r.role==="counselor"?"bg-blue-100 text-blue-800 border border-blue-200":"bg-green-100 text-green-800 border border-green-200"),children:r.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>{h(r),m(!0)},className:"text-brand-600 hover:text-brand-900 p-1.5 rounded-full hover:bg-brand-50 transition-colors",children:e.jsx(le,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{h(r),w(!0)},className:"text-red-600 hover:text-red-900 p-1.5 rounded-full hover:bg-red-50 transition-colors",disabled:r.role==="admin"&&L.filter(o=>o.role==="admin").length===1,children:e.jsx(de,{className:P("h-5 w-5",r.role==="admin"&&L.filter(o=>o.role==="admin").length===1?"opacity-50 cursor-not-allowed":"")})})]})})]},r.id))})]})})})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full transform transition-all",style:{animation:"modalFadeIn 0.3s ease-out"},children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4 rounded-t-xl text-white flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),s("userManagement.addUser","Add User")]}),e.jsx("button",{onClick:()=>l(!1),className:"text-white/80 hover:text-white p-1.5 rounded-full hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"text-xl",children:"×"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(W,{onSubmit:K,onCancel:()=>l(!1)})})]})}),e.jsx("style",{children:`
          @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
          }
        `}),S&&g&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full transform transition-all",style:{animation:"modalFadeIn 0.3s ease-out"},children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4 rounded-t-xl text-white flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(H,{className:"h-5 w-5 mr-2"}),s("userManagement.editUser","Edit User")]}),e.jsx("button",{onClick:()=>{m(!1),h(null)},className:"text-white/80 hover:text-white p-1.5 rounded-full hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"text-xl",children:"×"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(W,{initialData:g,onSubmit:Q,onCancel:()=>{m(!1),h(null)}})})]})}),I&&g&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:s("userManagement.confirmDelete","Confirm Delete")}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:s("userManagement.deleteConfirmation","Are you sure you want to delete this user? This action cannot be undone.")}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{w(!1),h(null)},className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:s("common.cancel","Cancel")}),e.jsx("button",{onClick:()=>X(g.id),className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:s("userManagement.confirmDelete","Delete")})]})]})}),J&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-auto",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:s("userManagement.importPreview","Import Preview")}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:s("userManagement.importCSVDescription",'Review the users that will be imported from your CSV file. Click "Import" to add these users to the system.')}),e.jsx("div",{className:"overflow-x-auto mb-6",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.name","Name")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.username","Username")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.email","Email")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.role","Role")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:R.map((r,t)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:r.username})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:r.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:P("px-2.5 py-0.5 rounded-full text-xs font-medium",r.role==="admin"?"bg-purple-100 text-purple-800":r.role==="counselor"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:r.role})})]},t))})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{E(!1),F([])},className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:s("common.cancel","Cancel")}),e.jsx("button",{onClick:_,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500",children:s("userManagement.confirmImport","Import")})]})]})})]})}export{xe as default};
