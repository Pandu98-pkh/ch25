import{u as ce,j as e,c as Q,s as _,t as ae,v as je,w as ye}from"./index-DSnDXcoI.js";import{r as o}from"./react-vendor-BzbKlFBU.js";import{I as we}from"./ImageUploader-CD__6Aq4.js";import{A as ne,t as V,b0 as Ne,a1 as ve,X as ke,S as ie,a0 as le,b1 as Ie,V as Ce,W as Ue,Q as Me,J as Se,T as Ee}from"./ui-vendor-BdkMv6fW.js";function oe({initialData:s,onSubmit:m,onCancel:x,isModal:S=!0,title:C,error:p}){const{t:n}=ce(),[d,y]=o.useState({userId:(s==null?void 0:s.userId)||"",name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||"",role:(s==null?void 0:s.role)||"counselor",username:(s==null?void 0:s.username)||"",password:(s==null?void 0:s.password)||"",photo:(s==null?void 0:s.photo)||(s==null?void 0:s.avatar)||"",avatar:(s==null?void 0:s.avatar)||(s==null?void 0:s.photo)||"",avatarType:(s==null?void 0:s.avatarType)||"url",avatarFilename:(s==null?void 0:s.avatarFilename)||""}),[k,I]=o.useState(!1),A=b=>{y({...d,photo:b.url,avatar:b.url,avatarType:b.type,avatarFilename:b.filename})},h=b=>{const{name:M,value:O}=b.target;y(R=>({...R,[M]:O}))},f=b=>{b.preventDefault(),m(d)},U=b=>{switch(b){case"admin":return e.jsx(ie,{className:"h-4 w-4"});case"counselor":return e.jsx(V,{className:"h-4 w-4"});case"student":return e.jsx(V,{className:"h-4 w-4"});default:return e.jsx(V,{className:"h-4 w-4"})}},T=e.jsxs("form",{onSubmit:f,className:"p-6",children:[p&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ne,{className:"h-5 w-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 mb-1",children:"Error"}),e.jsx("p",{className:"text-sm text-red-700",children:p})]})]})}),e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(V,{className:"h-5 w-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:s?"Edit User":"Tambah User Baru"}),e.jsx("p",{className:"text-sm text-blue-700",children:s?"Perbarui informasi user. ID pengguna tidak dapat diubah setelah dibuat.":"Isi informasi lengkap untuk membuat user baru. Pastikan ID unik untuk setiap user."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:"Informasi Dasar"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700",children:d.role==="student"?n("settings.studentId","Nomor Induk Siswa (NIS)"):d.role==="counselor"?n("settings.counselorId","ID Konselor"):n("settings.adminId","ID Administrator")}),e.jsx("input",{type:"text",id:"userId",name:"userId",value:d.userId,onChange:h,required:!0,readOnly:!!s,disabled:!!s,placeholder:d.role==="student"?"Contoh: 123456789":d.role==="counselor"?"Contoh: KSL-2025-001":"Contoh: ADM-2025-001",className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 ${s?"bg-gray-100 cursor-not-allowed":""}`}),s&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500 flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),n("settings.userIdCannotBeEdited","ID pengguna tidak dapat diubah setelah dibuat")]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:n("settings.name")}),e.jsx("input",{type:"text",id:"name",name:"name",value:d.name,onChange:h,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:n("settings.email")}),e.jsx("input",{type:"email",id:"email",name:"email",value:d.email,onChange:h,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:n("settings.username")}),e.jsx("input",{type:"text",id:"username",name:"username",value:d.username,onChange:h,required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:"Keamanan & Profil"}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:[n("settings.password"),s&&e.jsx("span",{className:"ml-2 text-xs text-gray-500 font-normal",children:"(Kosongkan jika tidak ingin mengubah password)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:k?"text":"password",id:"password",name:"password",value:d.password,onChange:h,required:!s,placeholder:s?"Kosongkan untuk tetap menggunakan password lama":"Masukkan password",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-500",onClick:()=>I(!k),children:k?e.jsx(Ne,{className:"h-4 w-4"}):e.jsx(ve,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:n("settings.role")}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{id:"role",name:"role",value:d.role,onChange:h,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500 pl-10",children:[e.jsx("option",{value:"admin",children:n("settings.roles.admin")}),e.jsx("option",{value:"counselor",children:n("settings.roles.counselor")}),e.jsx("option",{value:"student",children:n("settings.roles.student")}),e.jsx("option",{value:"staff",children:n("settings.roles.staff")})]}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:U(d.role)})]})]}),"          ",e.jsx("div",{children:e.jsx(we,{currentImage:d.photo||d.avatar||"",onImageChange:A,label:n("settings.photo","Foto Profil"),className:"w-full"})})]})]})]});return S?e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 bg-white",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:C||(s?n("settings.editUser","Edit User"):n("settings.addUser","Tambah User"))}),e.jsx("button",{onClick:x,className:"text-gray-400 hover:text-gray-500",children:e.jsx(ke,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"overflow-y-auto flex-1 scrollbar-light",children:T}),e.jsx("div",{className:"border-t border-gray-200 px-6 py-4 bg-gray-50",children:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:n("settings.cancel")}),e.jsx("button",{type:"submit",onClick:f,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500",children:n(s?"settings.update":"settings.create")})]})})]})}):e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[T,e.jsx("div",{className:"border-t border-gray-200 px-6 py-4 bg-gray-50",children:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:n("settings.cancel")}),e.jsx("button",{type:"submit",onClick:f,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500",children:n(s?"settings.update":"settings.create")})]})})]})}function de({isOpen:s,onClose:m,onConfirm:x,title:S,message:C,confirmText:p,isDestructive:n=!1,requiresTextConfirmation:d=!1,confirmationText:y=""}){const[k,I]=o.useState("");if(o.useEffect(()=>{s||I("")},[s]),!s)return null;const A=()=>{d&&k!==y||(x(),m())},h=!d||k===y;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full mx-4 p-6",children:[e.jsx("div",{className:"flex items-center mb-4",children:n?e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.96-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"})})}):e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:S}),e.jsx("p",{className:"text-sm text-gray-500 mb-4 whitespace-pre-line",children:C}),d&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:['Ketik "',y,'" untuk konfirmasi:']}),e.jsx("input",{type:"text",value:k,onChange:f=>I(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Ketik "${y}"`})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:m,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Batal"}),e.jsx("button",{onClick:A,disabled:!h,className:`flex-1 px-4 py-2 text-sm font-medium text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 ${n?"bg-red-600 hover:bg-red-700 focus:ring-red-500 disabled:bg-red-300":"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 disabled:bg-blue-300"} disabled:cursor-not-allowed`,children:p})]})]})})}function Le({isOpen:s,onClose:m,title:x,message:S,type:C}){if(!s)return null;const p=()=>{switch(C){case"success":return e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});case"error":return e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})});case"warning":return e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.96-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"})})})}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full mx-4 p-6",children:[e.jsx("div",{className:"flex items-center mb-4",children:p()}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:x}),e.jsx("p",{className:"text-sm text-gray-500 mb-4 whitespace-pre-line",children:S})]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:m,className:"px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"OK"})})]})})}const X="http://localhost:5000/api";function Re(){const[s,m]=o.useState([]),[x,S]=o.useState(!0),[C,p]=o.useState(null),[n,d]=o.useState(null),[y,k]=o.useState({isOpen:!1,userId:"",userName:""}),[I,A]=o.useState({isOpen:!1,userId:"",userName:""}),[h,f]=o.useState({isOpen:!1,title:"",message:"",type:"success"});o.useEffect(()=>{U()},[]);const U=async()=>{try{S(!0);const t=await fetch(`${X}/admin/users/deleted`);if(!t.ok)throw new Error("Failed to fetch deleted users");const c=await t.json();m(c),p(null)}catch(t){p(t instanceof Error?t.message:"An error occurred")}finally{S(!1)}},T=async t=>{try{d(t);const c=await fetch(`${X}/admin/users/${t}/restore`,{method:"PUT"});if(!c.ok){const L=await c.json();throw new Error(L.error||"Failed to restore user")}const E=await c.json();m(L=>L.filter(B=>B.userId!==t)),f({isOpen:!0,title:"Berhasil!",message:`✅ ${E.message}`,type:"success"})}catch(c){f({isOpen:!0,title:"Error!",message:`❌ Error: ${c instanceof Error?c.message:"Failed to restore user"}`,type:"error"})}finally{d(null)}},b=async t=>{try{d(t);const c=await fetch(`${X}/admin/users/${t}/hard-delete`,{method:"DELETE"});if(!c.ok){const L=await c.json();throw new Error(L.error||"Failed to permanently delete user")}const E=await c.json();m(L=>L.filter(B=>B.userId!==t)),f({isOpen:!0,title:"Data Dihapus Permanen!",message:`⚠️ ${E.message}
${E.warning}`,type:"warning"})}catch(c){f({isOpen:!0,title:"Error!",message:`❌ Error: ${c instanceof Error?c.message:"Failed to delete user permanently"}`,type:"error"})}finally{d(null)}},M=(t,c)=>{k({isOpen:!0,userId:t,userName:c})},O=(t,c)=>{A({isOpen:!0,userId:t,userName:c})},R=t=>t?new Date(t).toLocaleString("id-ID"):"Unknown",N=t=>{switch(t){case"admin":return"bg-red-100 text-red-800";case"counselor":return"bg-blue-100 text-blue-800";case"student":return"bg-green-100 text-green-800";case"staff":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return x?e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsx("div",{className:"text-lg text-gray-600",children:"Loading deleted users..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"🗑️ Manajemen User yang Dihapus"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Kelola user yang telah dihapus (soft delete)"})]}),e.jsx("button",{onClick:U,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"🔄 Refresh"})]}),C&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[e.jsx("strong",{children:"Error:"})," ",C]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Informasi Soft Delete"}),e.jsxs("div",{className:"mt-2 text-sm text-yellow-700",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Restore"}),": Mengaktifkan kembali user yang dihapus"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Hard Delete"}),": Menghapus permanen dari database (BERBAHAYA!)"]}),e.jsx("p",{children:"• User yang dihapus tidak dapat login tetapi data tetap tersimpan untuk audit"})]})]})]})}),s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎉"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Tidak ada user yang dihapus"}),e.jsx("p",{className:"text-gray-600",children:"Semua user dalam keadaan aktif atau telah dipulihkan."})]}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:s.map(t=>e.jsx("li",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"h-10 w-10 bg-gray-300 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.name.substring(0,2).toUpperCase()})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${N(t.role)}`,children:t.role})]}),e.jsxs("div",{className:"mt-1 space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"ID:"})," ",t.userId," | ",e.jsx("strong",{children:"Email:"})," ",t.email]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"Username:"})," ",t.username]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("strong",{children:"Dibuat:"})," ",R(t.createdAt)," |",e.jsx("strong",{children:" Dihapus:"})," ",R(t.deletedAt)]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>M(t.userId,t.name),disabled:n===t.userId,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",children:n===t.userId?e.jsx(e.Fragment,{children:"🔄 Restoring..."}):e.jsx(e.Fragment,{children:"🔄 Restore"})}),e.jsx("button",{onClick:()=>O(t.userId,t.name),disabled:n===t.userId,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:n===t.userId?e.jsx(e.Fragment,{children:"⏳ Processing..."}):e.jsx(e.Fragment,{children:"🗑️ Hard Delete"})})]})]})},t.userId))})}),"      ",s.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["Total ",s.length," user dihapus"]}),e.jsx(de,{isOpen:y.isOpen,onClose:()=>k({isOpen:!1,userId:"",userName:""}),onConfirm:()=>T(y.userId),title:"Konfirmasi Restore User",message:`Apakah Anda yakin ingin mengaktifkan kembali user "${y.userName}"?

User akan dapat login dan mengakses sistem kembali.`,confirmText:"Ya, Restore",isDestructive:!1}),e.jsx(de,{isOpen:I.isOpen,onClose:()=>A({isOpen:!1,userId:"",userName:""}),onConfirm:()=>b(I.userId),title:"⚠️ PERINGATAN: Hapus Permanen",message:`Menghapus permanen user "${I.userName}"?

Data akan hilang SELAMANYA dan tidak dapat dipulihkan!

Tindakan ini tidak dapat dibatalkan!`,confirmText:"Hapus Permanen",isDestructive:!0,requiresTextConfirmation:!0,confirmationText:"HAPUS PERMANEN"}),e.jsx(Le,{isOpen:h.isOpen,onClose:()=>f({isOpen:!1,title:"",message:"",type:"success"}),title:h.title,message:h.message,type:h.type})]})}function Pe(){const{t:s}=ce(),[m,x]=o.useState([]),[S,C]=o.useState(!0),[p,n]=o.useState(""),[d,y]=o.useState(!1),[k,I]=o.useState(!1),[A,h]=o.useState(!1),[f,U]=o.useState(null),[T,b]=o.useState(!1),[M,O]=o.useState([]),[R,N]=o.useState(null),[t,c]=o.useState(!1),[E,L]=o.useState(!1),[B,H]=o.useState(null),[W,q]=o.useState(!1),[J,Y]=o.useState(0),Z=o.useRef(null);o.useEffect(()=>{(async()=>{try{C(!0);const a=await _();x(a)}catch(a){console.error("Error loading users:",a)}finally{C(!1)}})()},[]);const G=m.filter(r=>r.name.toLowerCase().includes(p.toLowerCase())||r.email.toLowerCase().includes(p.toLowerCase())||r.role.toLowerCase().includes(p.toLowerCase())||r.userId&&r.userId.toLowerCase().includes(p.toLowerCase())||r.username&&r.username.toLowerCase().includes(p.toLowerCase())),me=async r=>{try{N(null);const a=await ae(r);x(l=>[...l,a]);try{const l=await _();x(l)}catch(l){console.warn("Failed to refresh users list after creation:",l)}y(!1)}catch(a){console.error("Error creating user:",a);const l=a instanceof Error?a.message:"Failed to create user. Please try again.";N(l)}},ue=async r=>{try{if(N(null),!r.userId)return;const a=await je(r.userId,r);x(l=>l.map(w=>w.userId===r.userId?a:w));try{const l=await _();x(l)}catch(l){console.warn("Failed to refresh users list after update:",l)}I(!1),U(null)}catch(a){console.error("Error updating user:",a);const l=a instanceof Error?a.message:"Failed to update user. Please try again.";N(l)}},xe=async r=>{try{await ye(r),x(m.filter(a=>a.userId!==r)),h(!1),U(null)}catch(a){console.error("Error deleting user:",a),alert("Failed to delete user. Please try again.")}},he=()=>{var r;(r=Z.current)==null||r.click()},ge=r=>{var w;const a=(w=r.target.files)==null?void 0:w[0];if(!a)return;const l=new FileReader;l.onload=u=>{var i;try{const g=((i=u.target)==null?void 0:i.result).split(`
`),P=g[0].split(",").map(K=>K.trim()),D=P.indexOf("name"),ee=P.indexOf("email"),se=P.indexOf("role"),re=P.indexOf("username"),te=P.indexOf("userId");if(D===-1||ee===-1||se===-1){alert("Invalid CSV format. The file must contain name, email, and role columns.");return}const F=[];for(let K=1;K<g.length;K++){if(!g[K].trim())continue;const z=g[K].split(",").map(v=>v.trim()),j={name:z[D],email:z[ee],role:z[se],username:re!==-1?z[re]:`user${m.length+F.length+1}`,password:"password123",userId:te!==-1?z[te]:""};j.userId||(j.role==="admin"?j.userId=`ADM${String(m.filter(v=>v.role==="admin").length+F.filter(v=>v.role==="admin").length+1).padStart(3,"0")}`:j.role==="counselor"?j.userId=`COUN${String(m.filter(v=>v.role==="counselor").length+F.filter(v=>v.role==="counselor").length+1).padStart(3,"0")}`:j.role==="student"?j.userId=`S${Math.floor(1e4+Math.random()*9e4)}`:j.userId=`USER${String(m.length+F.length+1).padStart(3,"0")}`),(m.some(v=>v.userId===j.userId)||F.some(v=>v.userId===j.userId))&&(j.userId=`${j.userId}-${Math.floor(1e3+Math.random()*9e3)}`),j.name&&j.email&&j.role&&F.push(j)}F.length>0?(O(F),b(!0)):alert("No valid users found in the CSV file.")}catch{alert("Error parsing CSV file. Please ensure the file contains valid CSV data.")}},l.readAsText(a),r.target.value=""},pe=async()=>{try{N(null),L(!0),q(!1),Y(0);const r=[],a=[],l=M.length;for(let u=0;u<M.length;u++){const i=M[u];try{const g=await ae(i);r.push(g)}catch(g){const P=g instanceof Error?g.message:"Unknown error";a.push({user:i,error:P})}const $=Math.round((u+1)/l*100);Y($),u<M.length-1&&await new Promise(g=>setTimeout(g,100))}const w=await _();if(x(w),q(!0),a.length>0){H(`${r.length} users imported successfully.`);const u=`${a.length} users failed to import: `+a.map(i=>`${i.user.name} (${i.error})`).join(", ");N(u)}else H(`Successfully imported all ${r.length} users!`)}catch(r){console.error("Error importing users:",r);const a=r instanceof Error?r.message:"Failed to import users. Please try again.";N(a),q(!0)}finally{L(!1)}},fe=()=>{const r=["userId","name","email","role","username"],a=m.map(({password:$,...g})=>[g.userId||"",g.name,g.email,g.role,g.username||""]),l=[r.join(","),...a.map($=>$.join(","))].join(`
`),w=new Blob([l],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(w),i=document.createElement("a");i.href=u,i.download="users.csv",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(u)},be=()=>{const r=["name","email","role","username","userId"],a=[["John Doe","john.doe@example.com","admin","johndoe","ADM001"],["Jane Smith","jane.smith@example.com","counselor","janesmith","COUN001"],["Bob Wilson","bob.wilson@example.com","student","bobwilson","S12345"],["Alice Brown","alice.brown@example.com","counselor","alicebrown",""],["Charlie Green","charlie.green@example.com","student","charliegreen",""]],l=[r.join(","),...a.map($=>$.join(","))].join(`
`),w=new Blob([l],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(w),i=document.createElement("a");i.href=u,i.download="user_import_template.csv",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(u)};return t?e.jsxs("div",{children:[e.jsx("div",{className:"mb-8 bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-xl px-8 py-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"🗑️ User yang Dihapus"}),e.jsx("p",{className:"mt-2 text-red-100 max-w-3xl",children:"Kelola user yang telah dihapus dari sistem (soft delete)"})]}),e.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 bg-white text-red-600 rounded-lg hover:bg-red-50 transition-colors font-medium",children:"← Kembali ke User Aktif"})]})}),e.jsx(Re,{})]}):S?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-8"}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden mb-8",children:[e.jsx("div",{className:"h-12 bg-gray-100 border-b border-gray-200"}),e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-10 bg-gray-100 rounded"})]})})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl px-8 py-6 shadow-lg",children:[e.jsx("h1",{className:"text-3xl font-bold",children:s("userManagement.title","User Management")}),e.jsx("p",{className:"mt-2 text-indigo-100 max-w-3xl",children:s("userManagement.subtitle","Manage users and their roles in the system")})]}),e.jsx("div",{className:"bg-white shadow-xl rounded-xl overflow-hidden mb-8 border border-gray-100",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-100 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-lg flex items-center justify-center text-white shadow-md mr-3",children:e.jsx(ie,{className:"h-5 w-5"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("userManagement.users","Users")})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:be,className:"inline-flex items-center px-4 py-2 border border-blue-300 rounded-lg text-sm font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 shadow-sm transition-all duration-200 hover:text-blue-800 hover:border-blue-400",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),s("userManagement.downloadTemplate","Download Template")]}),e.jsxs("button",{onClick:he,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 shadow-sm transition-all duration-200 hover:text-brand-600 hover:border-brand-500",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),s("userManagement.importUsers","Import Users")]}),e.jsx("input",{type:"file",ref:Z,accept:".csv",onChange:ge,className:"hidden"}),"                ",e.jsxs("button",{onClick:fe,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 shadow-sm transition-all duration-200 hover:text-brand-600 hover:border-brand-500",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),s("userManagement.exportUsers","Export Users")]}),e.jsxs("button",{onClick:()=>c(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 shadow-sm transition-all duration-200 hover:text-orange-600 hover:border-orange-500",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"User Dihapus"]}),e.jsxs("button",{onClick:()=>y(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-gradient-to-r from-brand-600 to-purple-600 hover:from-brand-700 hover:to-purple-700 shadow-md transition-all duration-200 transform hover:-translate-y-0.5",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),s("userManagement.addUser","Add User")]})]})]})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Me,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:s("userManagement.searchUsers","Search users..."),value:p,onChange:r=>n(r.target.value),className:"pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500 shadow-sm bg-white"})]}),"          ",e.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200 shadow-md",children:e.jsx("div",{className:"overflow-x-auto scrollbar-light",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.name","Name")}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.username","Username")}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.email","Email")}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.id","ID")}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.role","Role")}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider",children:s("userManagement.actions","Actions")})]})}),"                ",e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:G.map((r,a)=>e.jsxs("tr",{className:`hover:bg-indigo-50/30 transition-colors ${a%2===0?"bg-white":"bg-gray-50/50"}`,children:["                      ",e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex-shrink-0 h-10 w-10 relative",children:[r.photo||r.avatar?e.jsx("img",{src:r.photo||r.avatar,alt:r.name,className:"h-10 w-10 rounded-full object-cover border border-gray-200",onError:l=>{const w=l.currentTarget;w.style.display="none";const u=w.nextElementSibling;u&&u.classList.remove("hidden")}},`${r.userId}-${r.photo||r.avatar}`):null,e.jsx("div",{className:`h-10 w-10 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center border border-indigo-200 ${r.photo||r.avatar?"hidden":""}`,children:e.jsx(V,{className:"h-5 w-5 text-indigo-600"})})]}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-md inline-block",children:r.username})}),"                      ",e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-600 flex items-center",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 mr-2"}),r.email]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500 font-medium",children:r.userId||s("userManagement.idNotSet","Not set")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:Q("px-3 py-1.5 rounded-full text-xs font-medium",r.role==="admin"?"bg-purple-100 text-purple-800 border border-purple-200":r.role==="counselor"?"bg-blue-100 text-blue-800 border border-blue-200":"bg-green-100 text-green-800 border border-green-200"),children:r.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>{U(r),I(!0)},className:"text-brand-600 hover:text-brand-900 p-1.5 rounded-full hover:bg-brand-50 transition-colors",children:e.jsx(Se,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{U(r),h(!0)},className:"text-red-600 hover:text-red-900 p-1.5 rounded-full hover:bg-red-50 transition-colors",disabled:r.role==="admin"&&G.filter(l=>l.role==="admin").length===1,children:e.jsx(Ee,{className:Q("h-5 w-5",r.role==="admin"&&G.filter(l=>l.role==="admin").length===1?"opacity-50 cursor-not-allowed":"")})})]})})]},r.userId))})]})})})]})}),"      ",d&&e.jsx(oe,{onSubmit:me,onCancel:()=>{y(!1),N(null)},isModal:!0,title:s("userManagement.addUser","Tambah User Baru"),error:R}),"      ",k&&f&&e.jsx(oe,{initialData:f,onSubmit:ue,onCancel:()=>{I(!1),U(null),N(null)},isModal:!0,title:s("userManagement.editUser","Edit User"),error:R}),A&&f&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:s("userManagement.confirmDelete","Confirm Delete")}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:s("userManagement.deleteConfirmation","Are you sure you want to delete this user? This action cannot be undone.")}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{h(!1),U(null)},className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:s("common.cancel","Cancel")}),"              ",e.jsx("button",{onClick:()=>xe(f.userId),className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:s("userManagement.confirmDelete","Delete")})]})]})}),"      ","      ",T&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-auto scrollbar-light",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:W?"Import Results":s("userManagement.importPreview","Import Preview")}),!W&&e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:s("userManagement.importCSVDescription",'Review the users that will be imported from your CSV file. Click "Import" to add these users to the system.')}),R&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm",children:[e.jsx("strong",{children:"Error:"})," ",R]}),B&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 text-green-700 rounded-lg text-sm flex items-center",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 mr-2"}),e.jsx("strong",{children:"Success:"})," ",B]}),E&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Importing users..."}),e.jsxs("span",{className:"text-sm font-medium text-gray-500",children:[J,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-brand-600 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${J}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 text-center",children:["Processing ",Math.ceil(J/100*M.length)," of ",M.length," users"]})]}),!W&&!E&&e.jsx("div",{className:"overflow-x-auto mb-6 scrollbar-light",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.name","Name")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.username","Username")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.email","Email")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.id","ID")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.role","Role")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:M.map((r,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:r.username})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:r.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:r.userId||s("userManagement.idNotSet","Not set")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:Q("px-2.5 py-0.5 rounded-full text-xs font-medium",r.role==="admin"?"bg-purple-100 text-purple-800":r.role==="counselor"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:r.role})})]},a))})]})}),e.jsx("div",{className:"flex justify-end space-x-3",children:W?e.jsx("button",{onClick:()=>{b(!1),O([]),N(null),H(null),q(!1),Y(0)},className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{b(!1),O([]),N(null),H(null),Y(0)},className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:E,children:s("common.cancel","Cancel")}),e.jsx("button",{onClick:pe,disabled:E,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Importing... (",J,"%)"]}):s("userManagement.confirmImport","Import")})]})})]})})]})}export{Pe as default};
