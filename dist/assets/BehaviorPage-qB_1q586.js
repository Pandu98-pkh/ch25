import{u as $,j as e,c as G}from"./index-v6p7knVB.js";import{r as o}from"./react-vendor-CrzWfPmj.js";import{b as E,c as J}from"./api-C9ytrIjn.js";import{t as f}from"./toast-M3i0mrg7.js";import{p as y,R as U,i as P,h as W,$ as X,P as z,e as H,q as K,l as V,X as Q}from"./ui-vendor-DzlZg9lb.js";const g=[{id:"1",studentId:"1",date:"2024-04-02",type:"positive",description:"Membantu teman sekelas menyelesaikan tugas kelompok",severity:"positive",reporter:{id:"3",name:"Ms. Reynolds"},actionTaken:"Penghargaan verbal",category:"participation"},{id:"2",studentId:"2",date:"2024-04-03",type:"negative",description:"Tidak mengumpulkan tugas tepat waktu untuk ketiga kalinya",severity:"minor",reporter:{id:"4",name:"Mr. Wilson"},actionTaken:"Diskusi dengan siswa",category:"discipline"},{id:"3",studentId:"1",date:"2024-03-25",type:"negative",description:"Terlambat masuk kelas",severity:"minor",reporter:{id:"3",name:"Ms. Reynolds"},actionTaken:"Peringatan verbal",category:"attendance"}];let b=!0;const T=t=>{const s=new Set,r=[];for(const d of t)if(!s.has(d.id))s.add(d.id),r.push(d);else{const l=`${d.id}-${Date.now()}`;s.add(l),r.push({...d,id:l})}return r},Y=async(t,s,r=1)=>{try{if(b){console.log("Using mock behavior record data");let c=g.filter(u=>u.studentId===t);return{data:c,count:c.length,totalPages:1,currentPage:1}}const d=await E.get("/behavior/",{params:{student:t,page:r,...s}}),l=T(d.data.results||[]);return{data:l,count:l.length,totalPages:d.data.total_pages||1,currentPage:d.data.current_page||r}}catch(d){console.error("Error loading behavior records:",d),b=!0;const l=g.filter(u=>u.studentId===t),c=T(l);return{data:c,count:c.length,totalPages:1,currentPage:1}}},Z=async t=>{try{if(b){const r={...t,id:String(g.length+1)};return g.push(r),r}return(await E.post("/behavior/",t)).data}catch(s){if(console.error("Error creating behavior record:",s),!b){b=!0;const r={...t,id:String(Date.now())};return g.push(r),r}throw s}},ee={positive:"bg-green-50 text-green-700",neutral:"bg-gray-50 text-gray-700",minor:"bg-yellow-50 text-yellow-700",major:"bg-red-50 text-red-700"},se={attendance:P,discipline:y,participation:K,social:H};function de({studentId:t}){const{t:s}=$(),[r,d]=o.useState(""),[l,c]=o.useState([]),[u,j]=o.useState(!0),[N,m]=o.useState(null),[D,v]=o.useState(!1),[w,k]=o.useState(!1),[M,I]=o.useState([]),[h,R]=o.useState(t||""),[A,_]=o.useState(0),B=3,[n,x]=o.useState({category:"discipline",severity:"neutral",description:"",actionTaken:""}),S=o.useCallback(async()=>{try{I([{id:"1",name:"John Doe"},{id:"2",name:"Jane Smith"},{id:"3",name:"Alex Johnson"}])}catch(a){console.error("Error loading students:",a)}},[]),p=o.useCallback(async()=>{if(!h){j(!1);return}try{j(!0),m(null);const{clearTimeout:a}=J(15e3),i=await Y(h);a(),i&&i.data?c(i.data):(m(s("errors.invalidData")||"Format respons tidak valid"),c([]))}catch(a){console.error("Error loading behavior records:",a),a instanceof Error?a.name==="AbortError"||a.message.includes("timeout")?m(s("errors.timeout")||"Waktu permintaan habis"):m(a.message||s("errors.loadingRecords")||"Gagal memuat data"):m(s("errors.loadingRecords")||"Gagal memuat data"),c([])}finally{j(!1)}},[h,s]),L=async a=>{if(a.preventDefault(),!h){f.error(s("behavior.noStudentSelected")||"Silakan pilih siswa terlebih dahulu");return}if(!n.description.trim()){f.error(s("behavior.descriptionRequired")||"Deskripsi tidak boleh kosong");return}try{k(!0);const i={studentId:h,date:new Date().toISOString().split("T")[0],type:n.severity==="positive"?"positive":"negative",description:n.description,category:n.category,severity:n.severity,reporter:{id:"system",name:"System"},...n.actionTaken?{actionTaken:n.actionTaken}:{}};if(await Z(i))f.success(s("behavior.recordCreated")||"Catatan berhasil dibuat"),v(!1),p(),x({category:"discipline",severity:"neutral",description:"",actionTaken:""});else throw new Error("Failed to create record")}catch(i){console.error("Error creating behavior record:",i),f.error(i instanceof Error?i.message:s("behavior.createFailed")||"Gagal membuat catatan")}finally{k(!1)}},O=()=>{A<B?(_(a=>a+1),p()):m(s("errors.maxRetriesReached")||"Batas percobaan telah tercapai")};o.useEffect(()=>{S()},[S]),o.useEffect(()=>{p()},[p]),o.useEffect(()=>{t&&R(t)},[t]);const C=l.filter(a=>a.description.toLowerCase().includes(r.toLowerCase())),q=l.filter(a=>new Date(a.date).getMonth()===new Date().getMonth()),F=l.filter(a=>a.severity==="major");return u?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[...Array(3)].map((a,i)=>e.jsx("div",{className:"bg-white p-6 rounded-lg shadow animate-pulse",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-gray-200 mr-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded"})]})]})},i))}),e.jsx("div",{className:"bg-white rounded-lg shadow divide-y divide-gray-200",children:[...Array(3)].map((a,i)=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-5 w-5 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded"})]}),e.jsx("div",{className:"h-6 w-20 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"h-4 w-3/4 bg-gray-200 rounded"})]},i))})]}):N?e.jsxs("div",{className:"bg-red-50 p-6 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-700 mb-2",children:[e.jsx(y,{className:"h-5 w-5"}),e.jsx("h3",{className:"font-semibold",children:s("behavior.errorLoading")||"Gagal memuat catatan perilaku"})]}),e.jsx("p",{className:"text-red-600 mb-4",children:N}),e.jsxs("button",{onClick:O,className:"flex items-center px-4 py-2 bg-red-100 hover:bg-red-200 rounded-md text-red-800 transition-colors",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),s("actions.retry")||"Coba Lagi"]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s("behavior.title")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s("behavior.subtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-brand-50 rounded-lg",children:e.jsx(y,{className:"h-6 w-6 text-brand-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:s("behavior.stats.total")}),e.jsx("p",{className:"mt-1 text-3xl font-semibold text-gray-900",children:l.length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(P,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:s("behavior.stats.thisMonth")}),e.jsx("p",{className:"mt-1 text-3xl font-semibold text-gray-900",children:q.length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-50 rounded-lg",children:e.jsx(y,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:s("behavior.stats.needsAttention")}),e.jsx("p",{className:"mt-1 text-3xl font-semibold text-red-600",children:F.length})]})]})})]}),e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:s("behavior.search"),value:r,onChange:a=>d(a.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),s("behavior.filter")]}),e.jsxs("button",{onClick:()=>v(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-brand-600 hover:bg-brand-700",children:[e.jsx(z,{className:"h-5 w-5 mr-2"}),s("behavior.newRecord")]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"divide-y divide-gray-200",children:C.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:e.jsx("p",{children:s("behavior.noRecordsFound")||"Tidak ada catatan yang ditemukan"})}):C.map(a=>{const i=se[a.category];return e.jsxs("div",{className:"p-6 hover:bg-gray-50 transition-colors duration-150",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:V(new Date(a.date),"PPP")}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:s(`behavior.category.${a.category}`)})]}),e.jsx("div",{className:G("px-2.5 py-0.5 rounded-full text-xs font-medium",ee[a.severity]),children:s(`behavior.severity.${a.severity}`)})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:a.description}),a.actionTaken&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Action taken:"})," ",a.actionTaken]}),e.jsxs("div",{className:"mt-4 flex space-x-4",children:[e.jsx("button",{className:"text-sm font-medium text-brand-600 hover:text-brand-700",children:s("behavior.viewDetails")}),a.severity==="major"&&e.jsx("button",{className:"text-sm font-medium text-red-600 hover:text-red-700",children:s("behavior.scheduleIntervention")})]})]},a.id)})})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h3",{className:"text-lg font-medium",children:s("behavior.createNewRecord")}),e.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:text-gray-500",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:L,className:"p-6 space-y-4",children:[!t&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("behavior.student")}),e.jsxs("select",{value:h,onChange:a=>R(a.target.value),className:"w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-500 focus:border-brand-500",children:[e.jsx("option",{value:"",children:s("behavior.selectStudent")}),M.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("behavior.category.label")}),e.jsxs("select",{value:n.category,onChange:a=>x({...n,category:a.target.value}),className:"w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-500 focus:border-brand-500",children:[e.jsx("option",{value:"attendance",children:s("behavior.category.attendance")}),e.jsx("option",{value:"discipline",children:s("behavior.category.discipline")}),e.jsx("option",{value:"participation",children:s("behavior.category.participation")}),e.jsx("option",{value:"social",children:s("behavior.category.social")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("behavior.severity.label")}),e.jsxs("select",{value:n.severity,onChange:a=>x({...n,severity:a.target.value}),className:"w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-500 focus:border-brand-500",children:[e.jsx("option",{value:"positive",children:s("behavior.severity.positive")}),e.jsx("option",{value:"neutral",children:s("behavior.severity.neutral")}),e.jsx("option",{value:"minor",children:s("behavior.severity.minor")}),e.jsx("option",{value:"major",children:s("behavior.severity.major")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s("behavior.description")}),e.jsx("textarea",{value:n.description,onChange:a=>x({...n,description:a.target.value}),rows:3,className:"w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-500 focus:border-brand-500",placeholder:s("behavior.descriptionPlaceholder")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s("behavior.actionTaken")," (",s("common.optional"),")"]}),e.jsx("textarea",{value:n.actionTaken||"",onChange:a=>x({...n,actionTaken:a.target.value}),rows:2,className:"w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-brand-500 focus:border-brand-500",placeholder:s("behavior.actionTakenPlaceholder")})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-3 border-t mt-6",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500",children:s("common.cancel")}),e.jsx("button",{type:"submit",disabled:w,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-600 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 disabled:opacity-50",children:s(w?"common.saving":"common.save")})]})]})]})})]})}export{de as default};
