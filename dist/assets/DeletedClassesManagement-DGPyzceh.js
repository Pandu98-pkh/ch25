import{j as e}from"./index-BPryJHl5.js";import{u as K,r}from"./react-vendor-Brf1c7dg.js";import{$ as O,Q as S,aM as R,ao as v,T,b3 as D}from"./ui-vendor-iM6TVctI.js";function G({isOpen:l,onClose:o,onConfirm:i,title:m,message:x,confirmText:c,isDestructive:p=!1,requiresTextConfirmation:n=!1,confirmationText:h=""}){const[d,f]=r.useState("");if(r.useEffect(()=>{l||f("")},[l]),!l)return null;const a=()=>{n&&d!==h||(i(),o())},y=!n||d===h;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full mx-4 p-6",children:[e.jsx("div",{className:"flex items-center mb-4",children:p?e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(v,{className:"w-6 h-6 text-red-600"})}):e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(D,{className:"w-6 h-6 text-blue-600"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:m}),e.jsx("p",{className:"text-sm text-gray-500 mb-4 whitespace-pre-line",children:x}),n&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:['Ketik "',h,'" untuk konfirmasi:']}),e.jsx("input",{type:"text",value:d,onChange:g=>f(g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Ketik "${h}"`})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:o,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Batal"}),e.jsx("button",{onClick:a,disabled:!y,className:`flex-1 px-4 py-2 text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 ${p?"text-white bg-red-600 hover:bg-red-700 focus:ring-red-500 disabled:bg-red-300":"text-white bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 disabled:bg-blue-300"} disabled:cursor-not-allowed`,children:c})]})]})})}function H({isOpen:l,onClose:o,title:i,message:m,type:x}){if(!l)return null;const c=()=>{switch(x){case"success":return e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})});case"error":return e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})});case"warning":return e.jsx("div",{className:"flex-shrink-0 w-10 h-10 mx-auto bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(v,{className:"w-6 h-6 text-yellow-600"})})}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full mx-4 p-6",children:[e.jsx("div",{className:"flex items-center mb-4",children:c()}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:i}),e.jsx("p",{className:"text-sm text-gray-500 mb-4 whitespace-pre-line",children:m})]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:o,className:"px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"OK"})})]})})}const k="http://localhost:5000/api";function z(){const l=K(),[o,i]=r.useState([]),[m,x]=r.useState(!0),[c,p]=r.useState(null),[n,h]=r.useState(""),[d,f]=r.useState(null),[a,y]=r.useState({isOpen:!1,type:"restore",title:"",message:"",confirmText:"",isDestructive:!1,requiresTextConfirmation:!1,confirmationText:""}),[g,b]=r.useState({isOpen:!1,title:"",message:"",type:"success"});r.useEffect(()=>{C()},[]);const C=async()=>{try{x(!0),p(null),console.log("📡 Fetching deleted classes...");const s=await fetch(`${k}/admin/classes/deleted`);if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const t=await s.json();console.log("✅ Successfully fetched deleted classes:",t.length),i(Array.isArray(t)?t:[])}catch(s){console.error("❌ Error fetching deleted classes:",s),p(s instanceof Error?s.message:"Gagal memuat data kelas yang dihapus"),i([])}finally{x(!1)}},E=async s=>{try{console.log("🔄 Restoring class:",s.id);const t=await fetch(`${k}/admin/classes/${s.id}/restore`,{method:"PUT",headers:{"Content-Type":"application/json"}});if(!t.ok){const u=await t.json();throw new Error(u.error||`HTTP ${t.status}: ${t.statusText}`)}const w=await t.json();console.log("✅ Class restored successfully:",w),i(u=>u.filter(N=>N.id!==s.id)),b({isOpen:!0,title:"Kelas Dipulihkan",message:`Kelas "${s.name}" berhasil dipulihkan.`,type:"success"})}catch(t){console.error("❌ Error restoring class:",t),b({isOpen:!0,title:"Gagal Memulihkan",message:t instanceof Error?t.message:"Gagal memulihkan kelas",type:"error"})}},L=async s=>{try{console.log("🗑️ Permanently deleting class:",s.id);const t=await fetch(`${k}/admin/classes/${s.id}/hard-delete`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok){const u=await t.json();throw new Error(u.error||`HTTP ${t.status}: ${t.statusText}`)}const w=await t.json();console.log("✅ Class permanently deleted:",w),i(u=>u.filter(N=>N.id!==s.id)),b({isOpen:!0,title:"Kelas Dihapus Permanen",message:`Kelas "${s.name}" telah dihapus secara permanen dari database.`,type:"warning"})}catch(t){console.error("❌ Error permanently deleting class:",t),b({isOpen:!0,title:"Gagal Menghapus",message:t instanceof Error?t.message:"Gagal menghapus kelas secara permanen",type:"error"})}},A=s=>{f(s),y({isOpen:!0,type:"restore",title:"Pulihkan Kelas",message:`Apakah Anda yakin ingin memulihkan kelas "${s.name}"?

Kelas akan dikembalikan ke daftar kelas aktif.`,confirmText:"Pulihkan",isDestructive:!1,requiresTextConfirmation:!1,confirmationText:""})},$=s=>{f(s),y({isOpen:!0,type:"permanent-delete",title:"Hapus Permanen",message:`PERINGATAN: Aksi ini akan menghapus kelas "${s.name}" secara PERMANEN dari database.

Data kelas tidak dapat dipulihkan setelah dihapus permanen.

Ketik nama kelas untuk konfirmasi:`,confirmText:"Hapus Permanen",isDestructive:!0,requiresTextConfirmation:!0,confirmationText:s.name})},P=()=>{d&&(a.type==="restore"?E(d):a.type==="permanent-delete"&&L(d),f(null))},j=o.filter(s=>{if(!n)return!0;const t=n.toLowerCase();return s.name.toLowerCase().includes(t)||s.gradeLevel.toLowerCase().includes(t)||s.academicYear.toLowerCase().includes(t)||s.teacherName&&s.teacherName.toLowerCase().includes(t)}),M=s=>{if(!s)return"-";try{return new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return s}};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center mb-4",children:["            ",e.jsx("button",{onClick:()=>l("/app/classes"),className:"mr-4 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(O,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Kelas yang Dihapus"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Kelola kelas yang telah dihapus - pulihkan atau hapus permanen"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Cari kelas yang dihapus...",value:n,onChange:s=>h(s.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("button",{onClick:C,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Memuat data kelas yang dihapus..."})]}),c&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-700",children:c})]})}),!m&&!c&&e.jsx(e.Fragment,{children:j.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"bg-gray-100 w-16 h-16 rounded-full mx-auto flex items-center justify-center mb-4",children:e.jsx(T,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:n?"Tidak Ada Hasil":"Tidak Ada Kelas yang Dihapus"}),e.jsx("p",{className:"text-gray-500",children:n?"Tidak ada kelas yang dihapus sesuai dengan pencarian Anda.":"Semua kelas masih aktif. Kelas yang dihapus akan muncul di sini."})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kelas"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tingkat"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tahun Ajaran"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Guru"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Jumlah Siswa"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dihapus"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.schoolId})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:s.gradeLevel})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.academicYear}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.teacherName||"-"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[s.studentCount," siswa"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:M(s.deletedAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>A(s),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Pulihkan"]}),e.jsxs("button",{onClick:()=>$(s),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"Hapus Permanen"]})]})})]},s.id))})]})}),e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Menampilkan ",j.length," dari ",o.length," kelas yang dihapus"]})})]})}),e.jsx(G,{isOpen:a.isOpen,onClose:()=>y(s=>({...s,isOpen:!1})),onConfirm:P,title:a.title,message:a.message,confirmText:a.confirmText,isDestructive:a.isDestructive,requiresTextConfirmation:a.requiresTextConfirmation,confirmationText:a.confirmationText}),e.jsx(H,{isOpen:g.isOpen,onClose:()=>b(s=>({...s,isOpen:!1})),title:g.title,message:g.message,type:g.type})]})})}export{z as default};
